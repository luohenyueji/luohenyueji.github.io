import{_ as o}from"./plugin-vue_export-helper-x3n3nnut.js";import{r as e,o as c,c as l,a as n,b as s,d as t,e as p}from"./app-MsA2k2kn.js";const i={},u=n("h1",{id:"数据分析与可视化-python绘制数据地图2-geopandas地图可视化",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#数据分析与可视化-python绘制数据地图2-geopandas地图可视化","aria-hidden":"true"},"#"),s(" [数据分析与可视化] Python绘制数据地图2-GeoPandas地图可视化")],-1),r={href:"https://github.com/geopandas/geopandas",target:"_blank",rel:"noopener noreferrer"},d={href:"https://geopandas.org/en/stable/docs.html",target:"_blank",rel:"noopener noreferrer"},k={href:"https://blog.csdn.net/LuohenYJ/article/details/129596398",target:"_blank",rel:"noopener noreferrer"},m={href:"https://github.com/luohenyueji/Python-Study-Notes/blob/master/Plot%20Items/Mapping/Python%E7%BB%98%E5%88%B6%E6%95%B0%E6%8D%AE%E5%9C%B0%E5%9B%BE2-GeoPandas%E5%9C%B0%E5%9B%BE%E5%8F%AF%E8%A7%86%E5%8C%96/Python%E7%BB%98%E5%88%B6%E6%95%B0%E6%8D%AE%E5%9C%B0%E5%9B%BE2-GeoPandas%E5%9C%B0%E5%9B%BE%E5%8F%AF%E8%A7%86%E5%8C%96.ipynb",target:"_blank",rel:"noopener noreferrer"},v=p(`<p>GeoPandas推荐使用Python3.7版本及以上，运行环境最好是linux系统。GeoPandas安装命令如下：</p><blockquote><p>pip install geopandas</p></blockquote><p>如果上述命令安装出问题，则推荐使用conda安装GeoPandas，命令如下：</p><blockquote><p>conda install geopandas</p></blockquote><p>或：</p><blockquote><p>conda install --channel conda-forge geopandas</p></blockquote><p>[toc]</p><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code><span class="token comment">## jupyter notebook环境去除warning</span>
<span class="token keyword">import</span> warnings
warnings<span class="token punctuation">.</span>filterwarnings<span class="token punctuation">(</span><span class="token string">&quot;ignore&quot;</span><span class="token punctuation">)</span>

<span class="token comment">## 查看geopandas版本</span>
<span class="token keyword">import</span> geopandas <span class="token keyword">as</span> gpd

gpd<span class="token punctuation">.</span>__version__
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><pre><code>&#39;0.10.2&#39;
</code></pre><h2 id="_1-基础绘图" tabindex="-1"><a class="header-anchor" href="#_1-基础绘图" aria-hidden="true">#</a> 1 基础绘图</h2><h3 id="_1-1-绘图接口说明" tabindex="-1"><a class="header-anchor" href="#_1-1-绘图接口说明" aria-hidden="true">#</a> 1.1 绘图接口说明</h3><p>GeoPandas基于matplotlib库封装高级接口用于制作地图，GeoSeries或GeoDataFrame对象都提供了plot函数以进行对象可视化。与GeoSeries对象相比，GeoDataFrame对象提供的plot函数在参数上更为复杂，也更为常用。 GeoDataFrame对象提供的plot函数的常用输入参数如下：</p><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code><span class="token keyword">def</span> GeoDataFrame<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>
	column<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">,</span> np<span class="token punctuation">.</span>array<span class="token punctuation">,</span> pd<span class="token punctuation">.</span>Series <span class="token punctuation">(</span>default <span class="token boolean">None</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">## 用于绘图的列名或数据列</span>
	kind<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">,</span> <span class="token comment">## 绘图类型</span>
	cmap<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">,</span> <span class="token comment">## matplotlib的颜色图Colormaps</span>
	color<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">,</span> np<span class="token punctuation">.</span>array<span class="token punctuation">,</span> pd<span class="token punctuation">.</span>Series <span class="token punctuation">(</span>default <span class="token boolean">None</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">## 指定所有绘图对象的统一颜色</span>
	ax<span class="token punctuation">:</span> matplotlib<span class="token punctuation">.</span>pyplot<span class="token punctuation">.</span>Artist <span class="token punctuation">(</span>default <span class="token boolean">None</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">## 指定matplotlib的绘图轴</span>
	cax<span class="token punctuation">:</span> matplotlib<span class="token punctuation">.</span>pyplot Artist <span class="token punctuation">(</span>default <span class="token boolean">None</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">## 设置图例的坐标轴</span>
	categorical<span class="token punctuation">:</span> <span class="token builtin">bool</span> <span class="token punctuation">(</span>default <span class="token boolean">False</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">## 是否按照类别设置对象颜色</span>
	legend<span class="token punctuation">:</span> <span class="token builtin">bool</span> <span class="token punctuation">(</span>default <span class="token boolean">False</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">## 是否显示图例，如果column或color参数未赋值，则此参数无效</span>
	scheme<span class="token punctuation">:</span> <span class="token builtin">str</span> <span class="token punctuation">(</span>default <span class="token boolean">None</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">## 用于控制分层设色</span>
	k：<span class="token builtin">int</span> <span class="token punctuation">(</span>default <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">## scheme的层次数</span>
	vmin：<span class="token boolean">None</span> <span class="token keyword">or</span> <span class="token builtin">float</span> <span class="token punctuation">(</span>default <span class="token boolean">None</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">## 图例cmap的最小值</span>
	vmax：<span class="token boolean">None</span> <span class="token keyword">or</span> <span class="token builtin">float</span> <span class="token punctuation">(</span>default <span class="token boolean">None</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">## 图例cmap的最大值</span>
	markersize：<span class="token builtin">str</span> <span class="token keyword">or</span> <span class="token builtin">float</span> <span class="token keyword">or</span> sequence <span class="token punctuation">(</span>default <span class="token boolean">None</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">## 绘图点的大小</span>
	figsize<span class="token punctuation">:</span> <span class="token builtin">tuple</span> of integers <span class="token punctuation">(</span>default <span class="token boolean">None</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">## 用于控制matplotlib.figure.Figure</span>
	legend_kwds<span class="token punctuation">:</span> <span class="token builtin">dict</span> <span class="token punctuation">(</span>default <span class="token boolean">None</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">## matplotlib图例参数</span>
	missing_kw<span class="token punctuation">:</span> dsdict <span class="token punctuation">(</span>default <span class="token boolean">None</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">## 缺失值区域绘制参数</span>
	aspect<span class="token punctuation">:</span>‘auto’<span class="token punctuation">,</span> ‘equal’<span class="token punctuation">,</span> <span class="token boolean">None</span> <span class="token keyword">or</span> <span class="token builtin">float</span> <span class="token punctuation">(</span>default ‘auto’<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">## 设置绘图比例</span>
	<span class="token operator">**</span>style_kwds<span class="token punctuation">:</span> <span class="token builtin">dict</span><span class="token punctuation">,</span> <span class="token comment">## 其他参数，如对象边界色edgecolor, 对象填充色facecolor, 边界宽linewidth,透明度alpha</span>
<span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span>ax<span class="token punctuation">:</span> matplotlib axes instance
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>GeoSeries对象提供的plot函数的常用输入参数如下：</p><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code><span class="token keyword">def</span> GeoSeries<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>
	s<span class="token punctuation">:</span> Series<span class="token punctuation">,</span> <span class="token comment">## GeoSeries对象</span>
	cmap<span class="token punctuation">:</span> <span class="token builtin">str</span> <span class="token punctuation">(</span>default <span class="token boolean">None</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
	color<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">,</span> np<span class="token punctuation">.</span>array<span class="token punctuation">,</span> pd<span class="token punctuation">.</span>Series<span class="token punctuation">,</span> List <span class="token punctuation">(</span>default <span class="token boolean">None</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
	ax<span class="token punctuation">:</span> matplotlib<span class="token punctuation">.</span>pyplot<span class="token punctuation">.</span>Artist <span class="token punctuation">(</span>default <span class="token boolean">None</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
	figsize<span class="token punctuation">:</span> pair of floats <span class="token punctuation">(</span>default <span class="token boolean">None</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
	aspect<span class="token punctuation">:</span> ‘auto’<span class="token punctuation">,</span> ‘equal’<span class="token punctuation">,</span> <span class="token boolean">None</span> <span class="token keyword">or</span> <span class="token builtin">float</span> <span class="token punctuation">(</span>default ‘auto’<span class="token punctuation">)</span><span class="token punctuation">,</span>
	<span class="token operator">**</span>style_kwds<span class="token punctuation">:</span> <span class="token builtin">dict</span>
<span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span>ax<span class="token punctuation">:</span> matplotlib axes instance

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>想要更好使用以上参数最好熟悉matplotlib，如有不懂可以查阅matplotlib文档。下面简要介绍GeoPandas中绘图函数的使用。</p><p><strong>读取数据集</strong></p><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code><span class="token keyword">import</span> geopandas <span class="token keyword">as</span> gpd
<span class="token comment">## 读取自带世界地图数据集</span>
world <span class="token operator">=</span> gpd<span class="token punctuation">.</span>read_file<span class="token punctuation">(</span>gpd<span class="token punctuation">.</span>datasets<span class="token punctuation">.</span>get_path<span class="token punctuation">(</span><span class="token string">&#39;naturalearth_lowres&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment">## 人口，大洲，国名，国家缩写，ISO国家代码，gdp，地理位置数据</span>
world<span class="token punctuation">.</span>head<span class="token punctuation">(</span><span class="token punctuation">)</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div><table border="1" class="dataframe"><thead><tr style="text-align:right;"><th></th><th>pop_est</th><th>continent</th><th>name</th><th>iso_a3</th><th>gdp_md_est</th><th>geometry</th></tr></thead><tbody><tr><th>0</th><td>920938</td><td>Oceania</td><td>Fiji</td><td>FJI</td><td>8374.0</td><td>MULTIPOLYGON (((180.00000 -16.06713, 180.00000...</td></tr><tr><th>1</th><td>53950935</td><td>Africa</td><td>Tanzania</td><td>TZA</td><td>150600.0</td><td>POLYGON ((33.90371 -0.95000, 34.07262 -1.05982...</td></tr><tr><th>2</th><td>603253</td><td>Africa</td><td>W. Sahara</td><td>ESH</td><td>906.5</td><td>POLYGON ((-8.66559 27.65643, -8.66512 27.58948...</td></tr><tr><th>3</th><td>35623680</td><td>North America</td><td>Canada</td><td>CAN</td><td>1674000.0</td><td>MULTIPOLYGON (((-122.84000 49.00000, -122.9742...</td></tr><tr><th>4</th><td>326625791</td><td>North America</td><td>United States of America</td><td>USA</td><td>18560000.0</td><td>MULTIPOLYGON (((-122.84000 49.00000, -120.0000...</td></tr></tbody></table></div><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code>world<span class="token punctuation">.</span>plot<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><pre><code>&lt;matplotlib.axes._subplots.AxesSubplot at 0x7f17b270fe10&gt;
</code></pre><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code><span class="token comment">## 读取自带世界各大城市数据集</span>
cities <span class="token operator">=</span> gpd<span class="token punctuation">.</span>read_file<span class="token punctuation">(</span>gpd<span class="token punctuation">.</span>datasets<span class="token punctuation">.</span>get_path<span class="token punctuation">(</span><span class="token string">&#39;naturalearth_cities&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment">## 名字，地理位置数据</span>
cities<span class="token punctuation">.</span>head<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div><table border="1" class="dataframe"><thead><tr style="text-align:right;"><th></th><th>name</th><th>geometry</th></tr></thead><tbody><tr><th>0</th><td>Vatican City</td><td>POINT (12.45339 41.90328)</td></tr><tr><th>1</th><td>San Marino</td><td>POINT (12.44177 43.93610)</td></tr><tr><th>2</th><td>Vaduz</td><td>POINT (9.51667 47.13372)</td></tr><tr><th>3</th><td>Luxembourg</td><td>POINT (6.13000 49.61166)</td></tr><tr><th>4</th><td>Palikir</td><td>POINT (158.14997 6.91664)</td></tr></tbody></table></div><p><strong>分区统计图</strong></p><p>GeoPandas可以轻松创建分区统计图（每个形状的颜色基于关联变量值的地图）。只需在plot函数中将参数column设置为要用于指定颜色的列。</p><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code><span class="token comment">## 去除南极地区</span>
world <span class="token operator">=</span> world<span class="token punctuation">[</span><span class="token punctuation">(</span>world<span class="token punctuation">.</span>pop_est<span class="token operator">&gt;</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token punctuation">(</span>world<span class="token punctuation">.</span>name<span class="token operator">!=</span><span class="token string">&quot;Antarctica&quot;</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
<span class="token comment">## 计算人均gpd</span>
world<span class="token punctuation">[</span><span class="token string">&#39;gdp_per_cap&#39;</span><span class="token punctuation">]</span> <span class="token operator">=</span> world<span class="token punctuation">.</span>gdp_md_est <span class="token operator">/</span> world<span class="token punctuation">.</span>pop_est
<span class="token comment">## 绘图</span>
world<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>column<span class="token operator">=</span><span class="token string">&#39;gdp_per_cap&#39;</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><pre><code>&lt;matplotlib.axes._subplots.AxesSubplot at 0x7f17b241f390&gt;
</code></pre><figure><img src="https://gitlab.com/luohenyueji/article_picture_warehouse/-/raw/main/Python-Study-Notes/Mapping/[数据分析与可视化] Python绘制数据地图2-GeoPandas地图可视化/output_8_1.png" alt="png" tabindex="0" loading="lazy"><figcaption>png</figcaption></figure><p><strong>图例设置</strong></p><p>legend=True即可展示图例。</p><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code><span class="token keyword">import</span> matplotlib<span class="token punctuation">.</span>pyplot <span class="token keyword">as</span> plt

fig<span class="token punctuation">,</span> ax <span class="token operator">=</span> plt<span class="token punctuation">.</span>subplots<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
<span class="token comment">## 根据人口绘图数绘制</span>
world<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>column<span class="token operator">=</span><span class="token string">&#39;pop_est&#39;</span><span class="token punctuation">,</span> ax<span class="token operator">=</span>ax<span class="token punctuation">,</span> legend<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><pre><code>&lt;matplotlib.axes._subplots.AxesSubplot at 0x7f17b23585d0&gt;
</code></pre><figure><img src="https://gitlab.com/luohenyueji/article_picture_warehouse/-/raw/main/Python-Study-Notes/Mapping/[数据分析与可视化] Python绘制数据地图2-GeoPandas地图可视化/output_10_1.png" alt="png" tabindex="0" loading="lazy"><figcaption>png</figcaption></figure><p>但是我们会发现绘图区域和图例区域不对齐，我们通过mpl_toolkits设置图例轴，并通过cax参数直接控制plot函数的图例绘制。</p><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code><span class="token keyword">from</span> mpl_toolkits<span class="token punctuation">.</span>axes_grid1 <span class="token keyword">import</span> make_axes_locatable

fig<span class="token punctuation">,</span> ax <span class="token operator">=</span> plt<span class="token punctuation">.</span>subplots<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>

divider <span class="token operator">=</span> make_axes_locatable<span class="token punctuation">(</span>ax<span class="token punctuation">)</span>

<span class="token comment">## 设置图例，right表示位置，size=5%表示图例宽度，pad表示图例离图片间距</span>
cax <span class="token operator">=</span> divider<span class="token punctuation">.</span>append_axes<span class="token punctuation">(</span><span class="token string">&quot;right&quot;</span><span class="token punctuation">,</span> size<span class="token operator">=</span><span class="token string">&quot;5%&quot;</span><span class="token punctuation">,</span> pad<span class="token operator">=</span><span class="token number">0.2</span><span class="token punctuation">)</span>

world<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>column<span class="token operator">=</span><span class="token string">&#39;pop_est&#39;</span><span class="token punctuation">,</span> ax<span class="token operator">=</span>ax<span class="token punctuation">,</span> legend<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> cax<span class="token operator">=</span>cax<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><pre><code>&lt;matplotlib.axes._subplots.AxesSubplot at 0x7f17b21de650&gt;
</code></pre><figure><img src="https://gitlab.com/luohenyueji/article_picture_warehouse/-/raw/main/Python-Study-Notes/Mapping/[数据分析与可视化] Python绘制数据地图2-GeoPandas地图可视化/output_12_1.png" alt="png" tabindex="0" loading="lazy"><figcaption>png</figcaption></figure><p>此外我们可以通过legend_kwds设置图例信息和方向，就像matplotlib那样。</p><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code><span class="token keyword">import</span> matplotlib<span class="token punctuation">.</span>pyplot <span class="token keyword">as</span> plt

fig<span class="token punctuation">,</span> ax <span class="token operator">=</span> plt<span class="token punctuation">.</span>subplots<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>

world<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>column<span class="token operator">=</span><span class="token string">&#39;pop_est&#39;</span><span class="token punctuation">,</span>
           ax<span class="token operator">=</span>ax<span class="token punctuation">,</span>
           legend<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span>
           legend_kwds<span class="token operator">=</span><span class="token punctuation">{</span><span class="token string">&#39;label&#39;</span><span class="token punctuation">:</span> <span class="token string">&quot;Population by Country and Area&quot;</span><span class="token punctuation">,</span>
                        <span class="token string">&#39;orientation&#39;</span><span class="token punctuation">:</span> <span class="token string">&quot;horizontal&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><pre><code>&lt;matplotlib.axes._subplots.AxesSubplot at 0x7f17b20ec110&gt;
</code></pre><figure><img src="https://gitlab.com/luohenyueji/article_picture_warehouse/-/raw/main/Python-Study-Notes/Mapping/[数据分析与可视化] Python绘制数据地图2-GeoPandas地图可视化/output_14_1.png" alt="png" tabindex="0" loading="lazy"><figcaption>png</figcaption></figure><p><strong>颜色设置</strong></p>`,42),g={href:"https://matplotlib.org/stable/tutorials/colors/colormaps.html#sphx-glr-tutorials-colors-colormaps-py",target:"_blank",rel:"noopener noreferrer"},b=p(`<div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code><span class="token comment">## 设置颜色图为tab20</span>
world<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>column<span class="token operator">=</span><span class="token string">&#39;gdp_per_cap&#39;</span><span class="token punctuation">,</span> cmap<span class="token operator">=</span><span class="token string">&#39;tab20&#39;</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><pre><code>&lt;matplotlib.axes._subplots.AxesSubplot at 0x7f17b205a490&gt;
</code></pre><figure><img src="https://gitlab.com/luohenyueji/article_picture_warehouse/-/raw/main/Python-Study-Notes/Mapping/[数据分析与可视化] Python绘制数据地图2-GeoPandas地图可视化/output_16_1.png" alt="png" tabindex="0" loading="lazy"><figcaption>png</figcaption></figure><p>如果只想绘制边界，可以调用boundary属性进行绘制。</p><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code>world<span class="token punctuation">.</span>boundary<span class="token punctuation">.</span>plot<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><pre><code>&lt;matplotlib.axes._subplots.AxesSubplot at 0x7f15ac1cecd0&gt;
</code></pre><figure><img src="https://gitlab.com/luohenyueji/article_picture_warehouse/-/raw/main/Python-Study-Notes/Mapping/[数据分析与可视化] Python绘制数据地图2-GeoPandas地图可视化/output_18_1.png" alt="png" tabindex="0" loading="lazy"><figcaption>png</figcaption></figure><p><strong>缺失数据绘制</strong></p><p>当绘制项某些地图的数据缺失时，GeoPandas会自动放弃这些区域数据的绘制。如下所示。将Africa地区的gdp_per_cap数据设置为确实，那么将不在地图上绘制Africa地区的图形。</p><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code><span class="token keyword">import</span> numpy <span class="token keyword">as</span> np

world<span class="token punctuation">.</span>loc<span class="token punctuation">[</span>world<span class="token punctuation">[</span>world<span class="token punctuation">.</span>continent<span class="token operator">==</span><span class="token string">&quot;Africa&quot;</span><span class="token punctuation">]</span><span class="token punctuation">.</span>index<span class="token punctuation">,</span> <span class="token string">&#39;gdp_per_cap&#39;</span><span class="token punctuation">]</span> <span class="token operator">=</span> np<span class="token punctuation">.</span>nan
world<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>column<span class="token operator">=</span><span class="token string">&#39;gdp_per_cap&#39;</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><pre><code>&lt;matplotlib.axes._subplots.AxesSubplot at 0x7f15ac0afe50&gt;
</code></pre><figure><img src="https://gitlab.com/luohenyueji/article_picture_warehouse/-/raw/main/Python-Study-Notes/Mapping/[数据分析与可视化] Python绘制数据地图2-GeoPandas地图可视化/output_20_1.png" alt="png" tabindex="0" loading="lazy"><figcaption>png</figcaption></figure><p>如果我们想要在地图上展示缺失值的地区，可以通过missing_kwds设置相应的参数。如下所示：</p><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code><span class="token comment">## 将缺失值地区颜色设置为lightgrey</span>
world<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>column<span class="token operator">=</span><span class="token string">&#39;gdp_per_cap&#39;</span><span class="token punctuation">,</span> missing_kwds<span class="token operator">=</span><span class="token punctuation">{</span><span class="token string">&#39;color&#39;</span><span class="token punctuation">:</span> <span class="token string">&#39;lightgrey&#39;</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><pre><code>&lt;matplotlib.axes._subplots.AxesSubplot at 0x7f15ac094250&gt;
</code></pre><figure><img src="https://gitlab.com/luohenyueji/article_picture_warehouse/-/raw/main/Python-Study-Notes/Mapping/[数据分析与可视化] Python绘制数据地图2-GeoPandas地图可视化/output_22_1.png" alt="png" tabindex="0" loading="lazy"><figcaption>png</figcaption></figure><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code><span class="token comment">## 更复杂的例子，hatch表示内部图像样式</span>
ax <span class="token operator">=</span> world<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>column<span class="token operator">=</span><span class="token string">&#39;gdp_per_cap&#39;</span><span class="token punctuation">,</span> missing_kwds<span class="token operator">=</span><span class="token punctuation">{</span><span class="token string">&#39;color&#39;</span><span class="token punctuation">:</span> <span class="token string">&#39;lightgrey&#39;</span><span class="token punctuation">,</span><span class="token string">&#39;edgecolor&#39;</span><span class="token punctuation">:</span><span class="token string">&#39;red&#39;</span><span class="token punctuation">,</span><span class="token string">&quot;hatch&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;///&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;label&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;Missing values&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">## 不显示坐标轴</span>
ax<span class="token punctuation">.</span>set_axis_off<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="https://gitlab.com/luohenyueji/article_picture_warehouse/-/raw/main/Python-Study-Notes/Mapping/[数据分析与可视化] Python绘制数据地图2-GeoPandas地图可视化/output_23_0.png" alt="png" tabindex="0" loading="lazy"><figcaption>png</figcaption></figure><p><strong>图层设置</strong></p><p>当我们需要叠加多张地图或多个数据的结果，则需要用到地图的图层。GeoPandas提供了两种方式进行图层设置，但是要注意的是在合并地图之前，始终确保它们共享一个共同的坐标参考系crs。如将world地图和cities地图合并绘制。</p><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code><span class="token comment">## 以world数据集为准，对齐crs</span>
cities<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>marker<span class="token operator">=</span><span class="token string">&#39;*&#39;</span><span class="token punctuation">,</span> color<span class="token operator">=</span><span class="token string">&#39;green&#39;</span><span class="token punctuation">,</span> markersize<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">)</span>
cities <span class="token operator">=</span> cities<span class="token punctuation">.</span>to_crs<span class="token punctuation">(</span>world<span class="token punctuation">.</span>crs<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="https://gitlab.com/luohenyueji/article_picture_warehouse/-/raw/main/Python-Study-Notes/Mapping/[数据分析与可视化] Python绘制数据地图2-GeoPandas地图可视化/output_25_0.png" alt="png" tabindex="0" loading="lazy"><figcaption>png</figcaption></figure><p>第一种方式最为简单，直接通过ax参数控制绘图轴来实现图层叠加。</p><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code><span class="token comment">## base为绘图轴</span>
base <span class="token operator">=</span> world<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>color<span class="token operator">=</span><span class="token string">&#39;white&#39;</span><span class="token punctuation">,</span> edgecolor<span class="token operator">=</span><span class="token string">&#39;black&#39;</span><span class="token punctuation">)</span>

cities<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>ax<span class="token operator">=</span>base<span class="token punctuation">,</span> marker<span class="token operator">=</span><span class="token string">&#39;o&#39;</span><span class="token punctuation">,</span> color<span class="token operator">=</span><span class="token string">&#39;red&#39;</span><span class="token punctuation">,</span> markersize<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="https://gitlab.com/luohenyueji/article_picture_warehouse/-/raw/main/Python-Study-Notes/Mapping/[数据分析与可视化] Python绘制数据地图2-GeoPandas地图可视化/output_27_0.png" alt="png" tabindex="0" loading="lazy"><figcaption>png</figcaption></figure><p>第二种方式最为灵活，即通过matplotlib控制绘图。如果想要绘制更加美观的地图，这种方式更加推荐，但是需要了解matplotlib的使用。</p><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code><span class="token keyword">import</span> matplotlib<span class="token punctuation">.</span>pyplot <span class="token keyword">as</span> plt


<span class="token comment">## 设置绘图轴</span>
fig<span class="token punctuation">,</span> ax <span class="token operator">=</span> plt<span class="token punctuation">.</span>subplots<span class="token punctuation">(</span><span class="token punctuation">)</span>
ax<span class="token punctuation">.</span>set_aspect<span class="token punctuation">(</span><span class="token string">&#39;equal&#39;</span><span class="token punctuation">)</span>

world<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>ax<span class="token operator">=</span>ax<span class="token punctuation">,</span> color<span class="token operator">=</span><span class="token string">&#39;white&#39;</span><span class="token punctuation">,</span> edgecolor<span class="token operator">=</span><span class="token string">&#39;black&#39;</span><span class="token punctuation">)</span>
cities<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>ax<span class="token operator">=</span>ax<span class="token punctuation">,</span> marker<span class="token operator">=</span><span class="token string">&#39;o&#39;</span><span class="token punctuation">,</span> color<span class="token operator">=</span><span class="token string">&#39;red&#39;</span><span class="token punctuation">,</span> markersize<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">)</span>

plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="https://gitlab.com/luohenyueji/article_picture_warehouse/-/raw/main/Python-Study-Notes/Mapping/[数据分析与可视化] Python绘制数据地图2-GeoPandas地图可视化/output_29_0.png" alt="png" tabindex="0" loading="lazy"><figcaption>png</figcaption></figure><p><strong>图层顺序控制</strong></p><p>如果我们需要控制地图图层的展示顺序，即哪张图片显示在前。一种办法是通过绘图顺序设置，后绘制的数据的图层顺序越靠上。一种是通过zorder参数设置图层顺序，zorder值越大，表示图层顺序越靠上。如下所示：</p><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code><span class="token comment">## cities先绘制，则图层顺序更靠下，导致一些数据点被world图层遮盖。</span>
ax <span class="token operator">=</span> cities<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>color<span class="token operator">=</span><span class="token string">&#39;k&#39;</span><span class="token punctuation">)</span>

world<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>ax<span class="token operator">=</span>ax<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="https://gitlab.com/luohenyueji/article_picture_warehouse/-/raw/main/Python-Study-Notes/Mapping/[数据分析与可视化] Python绘制数据地图2-GeoPandas地图可视化/output_31_0.png" alt="png" tabindex="0" loading="lazy"><figcaption>png</figcaption></figure><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code><span class="token comment">## 调整绘图顺序，完整显示cities数据点</span>
ax <span class="token operator">=</span> world<span class="token punctuation">.</span>plot<span class="token punctuation">(</span><span class="token punctuation">)</span>

cities<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>ax<span class="token operator">=</span>ax<span class="token punctuation">,</span>color<span class="token operator">=</span><span class="token string">&#39;k&#39;</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><pre><code>&lt;matplotlib.axes._subplots.AxesSubplot at 0x7f159d535f10&gt;
</code></pre><figure><img src="https://gitlab.com/luohenyueji/article_picture_warehouse/-/raw/main/Python-Study-Notes/Mapping/[数据分析与可视化] Python绘制数据地图2-GeoPandas地图可视化/output_32_1.png" alt="png" tabindex="0" loading="lazy"><figcaption>png</figcaption></figure><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code><span class="token comment">## 通过zorder参数设置图层顺序，完整显示cities数据点</span>
ax <span class="token operator">=</span> cities<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>color<span class="token operator">=</span><span class="token string">&#39;k&#39;</span><span class="token punctuation">,</span>zorder<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span>

world<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>ax<span class="token operator">=</span>ax<span class="token punctuation">,</span>zorder<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><pre><code>&lt;matplotlib.axes._subplots.AxesSubplot at 0x7f159d4e8a10&gt;
</code></pre><figure><img src="https://gitlab.com/luohenyueji/article_picture_warehouse/-/raw/main/Python-Study-Notes/Mapping/[数据分析与可视化] Python绘制数据地图2-GeoPandas地图可视化/output_33_1.png" alt="png" tabindex="0" loading="lazy"><figcaption>png</figcaption></figure><p><strong>Pandas Plots</strong></p>`,39),h={href:"https://pandas.pydata.org/pandas-docs/stable/user_guide/visualization.html",target:"_blank",rel:"noopener noreferrer"},y=p(`<div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code>gdf <span class="token operator">=</span> world<span class="token punctuation">.</span>head<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span>

gdf<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>kind<span class="token operator">=</span><span class="token string">&#39;scatter&#39;</span><span class="token punctuation">,</span> x<span class="token operator">=</span><span class="token string">&quot;pop_est&quot;</span><span class="token punctuation">,</span> y<span class="token operator">=</span><span class="token string">&quot;gdp_md_est&quot;</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><pre><code>&lt;matplotlib.axes._subplots.AxesSubplot at 0x7f159d5d69d0&gt;
</code></pre><figure><img src="https://gitlab.com/luohenyueji/article_picture_warehouse/-/raw/main/Python-Study-Notes/Mapping/[数据分析与可视化] Python绘制数据地图2-GeoPandas地图可视化/output_35_1.png" alt="png" tabindex="0" loading="lazy"><figcaption>png</figcaption></figure><h3 id="_1-2-绘图实例之中国地图绘制" tabindex="-1"><a class="header-anchor" href="#_1-2-绘图实例之中国地图绘制" aria-hidden="true">#</a> 1.2 绘图实例之中国地图绘制</h3><p>该实例主要参考：</p>`,5),x={href:"https://www.cnblogs.com/feffery/p/12361421.html",target:"_blank",rel:"noopener noreferrer"},f={href:"https://cloud.tencent.com/developer/article/1790603",target:"_blank",rel:"noopener noreferrer"},_=p(`<p><strong>1 读取地图数据</strong></p><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code><span class="token keyword">import</span> geopandas <span class="token keyword">as</span> gpd
<span class="token keyword">import</span> matplotlib<span class="token punctuation">.</span>pyplot <span class="token keyword">as</span> plt

<span class="token comment">## 读取中国地图数据，数据来自DataV.GeoAtlas，将其投影到EPSG:4573</span>
data <span class="token operator">=</span> gpd<span class="token punctuation">.</span>read_file<span class="token punctuation">(</span><span class="token string">&#39;https://geo.datav.aliyun.com/areas_v3/bound/100000_full.json&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>to_crs<span class="token punctuation">(</span><span class="token string">&#39;EPSG:4573&#39;</span><span class="token punctuation">)</span>
<span class="token comment">## 中国有34个省级行政区，最后一条数据为南海九段线</span>
data<span class="token punctuation">.</span>shape
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><pre><code>(35, 8)
</code></pre><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code><span class="token comment">## 保存各个省级行政区的面积，单位万平方公里</span>
data<span class="token punctuation">[</span><span class="token string">&#39;area&#39;</span><span class="token punctuation">]</span> <span class="token operator">=</span> data<span class="token punctuation">.</span>area<span class="token operator">/</span><span class="token number">1e6</span><span class="token operator">/</span><span class="token number">1e4</span>
<span class="token comment">## 中国疆域总面积，和官方数据会有差距</span>
data<span class="token punctuation">[</span><span class="token string">&#39;area&#39;</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token builtin">sum</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><pre><code>989.1500769770855
</code></pre><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code><span class="token comment">## 查看最后五条数据</span>
data<span class="token punctuation">.</span>tail<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><div><table border="1" class="dataframe"><thead><tr style="text-align:right;"><th></th><th>adcode</th><th>name</th><th>adchar</th><th>childrenNum</th><th>level</th><th>parent</th><th>subFeatureIndex</th><th>geometry</th><th>area</th></tr></thead><tbody><tr><th>30</th><td>650000</td><td>新疆维吾尔自治区</td><td>NaN</td><td>24.0</td><td>province</td><td>{&#39;adcode&#39;: 100000}</td><td>30.0</td><td>MULTIPOLYGON (((17794320.693 4768675.631, 1779...</td><td>175.796459</td></tr><tr><th>31</th><td>710000</td><td>台湾省</td><td>NaN</td><td>0.0</td><td>province</td><td>{&#39;adcode&#39;: 100000}</td><td>31.0</td><td>MULTIPOLYGON (((20103629.026 2566628.808, 2011...</td><td>4.090259</td></tr><tr><th>32</th><td>810000</td><td>香港特别行政区</td><td>NaN</td><td>18.0</td><td>province</td><td>{&#39;adcode&#39;: 100000}</td><td>32.0</td><td>MULTIPOLYGON (((19432072.340 2517924.724, 1942...</td><td>0.125928</td></tr><tr><th>33</th><td>820000</td><td>澳门特别行政区</td><td>NaN</td><td>8.0</td><td>province</td><td>{&#39;adcode&#39;: 100000}</td><td>33.0</td><td>MULTIPOLYGON (((19385068.278 2470740.132, 1939...</td><td>0.004702</td></tr><tr><th>34</th><td>100000_JD</td><td></td><td>JD</td><td>NaN</td><td>NaN</td><td>NaN</td><td>NaN</td><td>MULTIPOLYGON (((20309263.208 2708129.155, 2032...</td><td>0.280824</td></tr></tbody></table></div><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code><span class="token comment">## 拆分数据</span>
nine_dotted_line <span class="token operator">=</span> data<span class="token punctuation">.</span>iloc<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span>
data <span class="token operator">=</span> data<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span>
nine_dotted_line
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><pre><code>adcode                                                     100000_JD
name                                                                
adchar                                                            JD
childrenNum                                                      NaN
level                                                            NaN
parent                                                           NaN
subFeatureIndex                                                  NaN
geometry           MULTIPOLYGON (((20309263.208229765 2708129.154...
area                                                        0.280824
Name: 34, dtype: object
</code></pre><p><strong>2 地图绘制</strong></p><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code><span class="token comment">## 创建画布matplotlib</span>
fig<span class="token punctuation">,</span> ax <span class="token operator">=</span> plt<span class="token punctuation">.</span>subplots<span class="token punctuation">(</span>figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">12</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment">## 绘制主要区域</span>
ax <span class="token operator">=</span> data<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>ax<span class="token operator">=</span>ax<span class="token punctuation">)</span>
<span class="token comment">## 绘制九段线</span>
ax <span class="token operator">=</span> gpd<span class="token punctuation">.</span>GeoSeries<span class="token punctuation">(</span>nine_dotted_line<span class="token punctuation">.</span>geometry<span class="token punctuation">)</span><span class="token punctuation">.</span>plot<span class="token punctuation">(</span>ax<span class="token operator">=</span>ax<span class="token punctuation">,</span>edgecolor<span class="token operator">=</span><span class="token string">&#39;red&#39;</span><span class="token punctuation">,</span>linewidth<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">)</span>
<span class="token comment">## 保存结果</span>
fig<span class="token punctuation">.</span>savefig<span class="token punctuation">(</span><span class="token string">&#39;res.png&#39;</span><span class="token punctuation">,</span> dpi<span class="token operator">=</span><span class="token number">300</span><span class="token punctuation">,</span> bbox_inches<span class="token operator">=</span><span class="token string">&#39;tight&#39;</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="https://gitlab.com/luohenyueji/article_picture_warehouse/-/raw/main/Python-Study-Notes/Mapping/[数据分析与可视化] Python绘制数据地图2-GeoPandas地图可视化/output_43_0.png" alt="png" tabindex="0" loading="lazy"><figcaption>png</figcaption></figure><p><strong>3 绘图自定义</strong></p><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code><span class="token comment">## 创建画布matplotlib</span>
fig<span class="token punctuation">,</span> ax <span class="token operator">=</span> plt<span class="token punctuation">.</span>subplots<span class="token punctuation">(</span>figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">12</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment">## 绘制主要区域</span>
ax <span class="token operator">=</span> data<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>ax<span class="token operator">=</span>ax<span class="token punctuation">,</span>facecolor<span class="token operator">=</span><span class="token string">&#39;grey&#39;</span><span class="token punctuation">,</span>edgecolor<span class="token operator">=</span><span class="token string">&#39;lightgrey&#39;</span><span class="token punctuation">,</span>alpha<span class="token operator">=</span><span class="token number">0.8</span><span class="token punctuation">,</span>linewidth<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>
<span class="token comment">## 绘制九段线</span>
ax <span class="token operator">=</span> gpd<span class="token punctuation">.</span>GeoSeries<span class="token punctuation">(</span>nine_dotted_line<span class="token punctuation">.</span>geometry<span class="token punctuation">)</span><span class="token punctuation">.</span>plot<span class="token punctuation">(</span>ax<span class="token operator">=</span>ax<span class="token punctuation">,</span>edgecolor<span class="token operator">=</span><span class="token string">&#39;grey&#39;</span><span class="token punctuation">,</span>linewidth<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">)</span>
<span class="token comment">## 强调首都</span>
ax <span class="token operator">=</span> data<span class="token punctuation">[</span>data<span class="token punctuation">.</span>name<span class="token operator">==</span><span class="token string">&quot;北京市&quot;</span><span class="token punctuation">]</span><span class="token punctuation">.</span>representative_point<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>plot<span class="token punctuation">(</span>ax<span class="token operator">=</span>ax<span class="token punctuation">,</span> facecolor<span class="token operator">=</span><span class="token string">&#39;red&#39;</span><span class="token punctuation">,</span>marker<span class="token operator">=</span><span class="token string">&#39;*&#39;</span><span class="token punctuation">,</span> markersize<span class="token operator">=</span><span class="token number">150</span><span class="token punctuation">)</span> 

<span class="token comment">## 强调港澳台</span>
<span class="token comment">## 设置字体</span>
fontdict <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">&#39;family&#39;</span><span class="token punctuation">:</span><span class="token string">&#39;FZSongYi-Z13S&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;size&#39;</span><span class="token punctuation">:</span><span class="token number">8</span><span class="token punctuation">,</span> <span class="token string">&#39;color&#39;</span><span class="token punctuation">:</span> <span class="token string">&quot;blue&quot;</span><span class="token punctuation">,</span><span class="token string">&#39;weight&#39;</span><span class="token punctuation">:</span> <span class="token string">&#39;bold&#39;</span><span class="token punctuation">}</span>
<span class="token keyword">for</span> index <span class="token keyword">in</span> data<span class="token punctuation">[</span>data<span class="token punctuation">.</span>adcode<span class="token punctuation">.</span>isin<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">&#39;710000&#39;</span><span class="token punctuation">,</span><span class="token string">&#39;810000&#39;</span><span class="token punctuation">,</span><span class="token string">&#39;820000&#39;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">.</span>index<span class="token punctuation">:</span>
    <span class="token keyword">if</span> data<span class="token punctuation">.</span>iloc<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">&#39;name&#39;</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">&quot;台湾省&quot;</span><span class="token punctuation">:</span>
        x <span class="token operator">=</span> data<span class="token punctuation">.</span>iloc<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">.</span>geometry<span class="token punctuation">.</span>centroid<span class="token punctuation">.</span>x
        y <span class="token operator">=</span> data<span class="token punctuation">.</span>iloc<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">.</span>geometry<span class="token punctuation">.</span>centroid<span class="token punctuation">.</span>y
        name <span class="token operator">=</span> <span class="token string">&quot;台湾省&quot;</span>
        ax<span class="token punctuation">.</span>text<span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> name<span class="token punctuation">,</span> ha<span class="token operator">=</span><span class="token string">&quot;center&quot;</span><span class="token punctuation">,</span> va<span class="token operator">=</span><span class="token string">&quot;center&quot;</span><span class="token punctuation">,</span> fontdict<span class="token operator">=</span>fontdict<span class="token punctuation">)</span>
    <span class="token keyword">elif</span> data<span class="token punctuation">.</span>iloc<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">&#39;name&#39;</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">&quot;香港特别行政区&quot;</span><span class="token punctuation">:</span>
        x <span class="token operator">=</span> data<span class="token punctuation">.</span>iloc<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">.</span>geometry<span class="token punctuation">.</span>centroid<span class="token punctuation">.</span>x
        y <span class="token operator">=</span> data<span class="token punctuation">.</span>iloc<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">.</span>geometry<span class="token punctuation">.</span>centroid<span class="token punctuation">.</span>y
        name <span class="token operator">=</span> <span class="token string">&quot;香港&quot;</span>
        ax<span class="token punctuation">.</span>text<span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> name<span class="token punctuation">,</span> ha<span class="token operator">=</span><span class="token string">&quot;left&quot;</span><span class="token punctuation">,</span> va<span class="token operator">=</span><span class="token string">&quot;top&quot;</span><span class="token punctuation">,</span> fontdict<span class="token operator">=</span>fontdict<span class="token punctuation">)</span>
        gpd<span class="token punctuation">.</span>GeoSeries<span class="token punctuation">(</span>data<span class="token punctuation">.</span>iloc<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">.</span>geometry<span class="token punctuation">.</span>centroid<span class="token punctuation">)</span><span class="token punctuation">.</span>plot<span class="token punctuation">(</span>ax<span class="token operator">=</span>ax<span class="token punctuation">,</span> facecolor<span class="token operator">=</span><span class="token string">&#39;black&#39;</span><span class="token punctuation">,</span> markersize<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">)</span>
    <span class="token keyword">elif</span> data<span class="token punctuation">.</span>iloc<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">&#39;name&#39;</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">&quot;澳门特别行政区&quot;</span><span class="token punctuation">:</span>
        x <span class="token operator">=</span> data<span class="token punctuation">.</span>iloc<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">.</span>geometry<span class="token punctuation">.</span>centroid<span class="token punctuation">.</span>x
        y <span class="token operator">=</span> data<span class="token punctuation">.</span>iloc<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">.</span>geometry<span class="token punctuation">.</span>centroid<span class="token punctuation">.</span>y
        name <span class="token operator">=</span> <span class="token string">&quot;澳门&quot;</span>
        ax<span class="token punctuation">.</span>text<span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> name<span class="token punctuation">,</span> ha<span class="token operator">=</span><span class="token string">&quot;right&quot;</span><span class="token punctuation">,</span> va<span class="token operator">=</span><span class="token string">&quot;top&quot;</span><span class="token punctuation">,</span> fontdict<span class="token operator">=</span>fontdict<span class="token punctuation">)</span>
        gpd<span class="token punctuation">.</span>GeoSeries<span class="token punctuation">(</span>data<span class="token punctuation">.</span>iloc<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">.</span>geometry<span class="token punctuation">.</span>centroid<span class="token punctuation">)</span><span class="token punctuation">.</span>plot<span class="token punctuation">(</span>ax<span class="token operator">=</span>ax<span class="token punctuation">,</span> facecolor<span class="token operator">=</span><span class="token string">&#39;black&#39;</span><span class="token punctuation">,</span> markersize<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">)</span>

<span class="token comment">## 移除坐标轴</span>
ax<span class="token punctuation">.</span>axis<span class="token punctuation">(</span><span class="token string">&#39;off&#39;</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><pre><code>(15508157.566510478, 20969512.421140186, 92287.20109282521, 6384866.68627745)
</code></pre><figure><img src="https://gitlab.com/luohenyueji/article_picture_warehouse/-/raw/main/Python-Study-Notes/Mapping/[数据分析与可视化] Python绘制数据地图2-GeoPandas地图可视化/output_45_1.png" alt="png" tabindex="0" loading="lazy"><figcaption>png</figcaption></figure><p><strong>4 图例设置</strong></p><p>这里采用单独绘制图例的方式来创建图例，需要对matplotlib使用有一定的了解。</p><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code><span class="token comment">## 创建画布matplotlib</span>
fig<span class="token punctuation">,</span> ax <span class="token operator">=</span> plt<span class="token punctuation">.</span>subplots<span class="token punctuation">(</span>figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">12</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment">## 绘制主要区域</span>
ax <span class="token operator">=</span> data<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>ax<span class="token operator">=</span>ax<span class="token punctuation">,</span>facecolor<span class="token operator">=</span><span class="token string">&#39;grey&#39;</span><span class="token punctuation">,</span>edgecolor<span class="token operator">=</span><span class="token string">&#39;lightgrey&#39;</span><span class="token punctuation">,</span>alpha<span class="token operator">=</span><span class="token number">0.8</span><span class="token punctuation">,</span>linewidth<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>
<span class="token comment">## 绘制九段线</span>
ax <span class="token operator">=</span> gpd<span class="token punctuation">.</span>GeoSeries<span class="token punctuation">(</span>nine_dotted_line<span class="token punctuation">.</span>geometry<span class="token punctuation">)</span><span class="token punctuation">.</span>plot<span class="token punctuation">(</span>ax<span class="token operator">=</span>ax<span class="token punctuation">,</span>edgecolor<span class="token operator">=</span><span class="token string">&#39;grey&#39;</span><span class="token punctuation">,</span>linewidth<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">)</span>
<span class="token comment">## 强调首都</span>
ax <span class="token operator">=</span> data<span class="token punctuation">[</span>data<span class="token punctuation">.</span>name<span class="token operator">==</span><span class="token string">&quot;北京市&quot;</span><span class="token punctuation">]</span><span class="token punctuation">.</span>representative_point<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>plot<span class="token punctuation">(</span>ax<span class="token operator">=</span>ax<span class="token punctuation">,</span> facecolor<span class="token operator">=</span><span class="token string">&#39;red&#39;</span><span class="token punctuation">,</span>marker<span class="token operator">=</span><span class="token string">&#39;*&#39;</span><span class="token punctuation">,</span> markersize<span class="token operator">=</span><span class="token number">150</span><span class="token punctuation">)</span> 

<span class="token comment">## 强调港澳台</span>
<span class="token comment">## 设置字体</span>
fontdict <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">&#39;family&#39;</span><span class="token punctuation">:</span><span class="token string">&#39;FZSongYi-Z13S&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;size&#39;</span><span class="token punctuation">:</span><span class="token number">8</span><span class="token punctuation">,</span> <span class="token string">&#39;color&#39;</span><span class="token punctuation">:</span> <span class="token string">&quot;blue&quot;</span><span class="token punctuation">,</span><span class="token string">&#39;weight&#39;</span><span class="token punctuation">:</span> <span class="token string">&#39;bold&#39;</span><span class="token punctuation">}</span>
<span class="token comment">## 这一段代码可能因为不同matplotlib版本出现不同结果</span>
<span class="token keyword">for</span> index <span class="token keyword">in</span> data<span class="token punctuation">[</span>data<span class="token punctuation">.</span>adcode<span class="token punctuation">.</span>isin<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">&#39;710000&#39;</span><span class="token punctuation">,</span><span class="token string">&#39;810000&#39;</span><span class="token punctuation">,</span><span class="token string">&#39;820000&#39;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">.</span>index<span class="token punctuation">:</span>
    <span class="token keyword">if</span> data<span class="token punctuation">.</span>iloc<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">&#39;name&#39;</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">&quot;台湾省&quot;</span><span class="token punctuation">:</span>
        x <span class="token operator">=</span> data<span class="token punctuation">.</span>iloc<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">.</span>geometry<span class="token punctuation">.</span>centroid<span class="token punctuation">.</span>x
        y <span class="token operator">=</span> data<span class="token punctuation">.</span>iloc<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">.</span>geometry<span class="token punctuation">.</span>centroid<span class="token punctuation">.</span>y
        name <span class="token operator">=</span> <span class="token string">&quot;台湾省&quot;</span>
        ax<span class="token punctuation">.</span>text<span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> name<span class="token punctuation">,</span> ha<span class="token operator">=</span><span class="token string">&quot;center&quot;</span><span class="token punctuation">,</span> va<span class="token operator">=</span><span class="token string">&quot;center&quot;</span><span class="token punctuation">,</span> fontdict<span class="token operator">=</span>fontdict<span class="token punctuation">)</span>
    <span class="token keyword">elif</span> data<span class="token punctuation">.</span>iloc<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">&#39;name&#39;</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">&quot;香港特别行政区&quot;</span><span class="token punctuation">:</span>
        x <span class="token operator">=</span> data<span class="token punctuation">.</span>iloc<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">.</span>geometry<span class="token punctuation">.</span>centroid<span class="token punctuation">.</span>x
        y <span class="token operator">=</span> data<span class="token punctuation">.</span>iloc<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">.</span>geometry<span class="token punctuation">.</span>centroid<span class="token punctuation">.</span>y
        name <span class="token operator">=</span> <span class="token string">&quot;香港&quot;</span>
        ax<span class="token punctuation">.</span>text<span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> name<span class="token punctuation">,</span> ha<span class="token operator">=</span><span class="token string">&quot;left&quot;</span><span class="token punctuation">,</span> va<span class="token operator">=</span><span class="token string">&quot;top&quot;</span><span class="token punctuation">,</span> fontdict<span class="token operator">=</span>fontdict<span class="token punctuation">)</span>
        gpd<span class="token punctuation">.</span>GeoSeries<span class="token punctuation">(</span>data<span class="token punctuation">.</span>iloc<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">.</span>geometry<span class="token punctuation">.</span>centroid<span class="token punctuation">)</span><span class="token punctuation">.</span>plot<span class="token punctuation">(</span>ax<span class="token operator">=</span>ax<span class="token punctuation">,</span> facecolor<span class="token operator">=</span><span class="token string">&#39;black&#39;</span><span class="token punctuation">,</span> markersize<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">)</span>
    <span class="token keyword">elif</span> data<span class="token punctuation">.</span>iloc<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">&#39;name&#39;</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">&quot;澳门特别行政区&quot;</span><span class="token punctuation">:</span>
        x <span class="token operator">=</span> data<span class="token punctuation">.</span>iloc<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">.</span>geometry<span class="token punctuation">.</span>centroid<span class="token punctuation">.</span>x
        y <span class="token operator">=</span> data<span class="token punctuation">.</span>iloc<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">.</span>geometry<span class="token punctuation">.</span>centroid<span class="token punctuation">.</span>y
        name <span class="token operator">=</span> <span class="token string">&quot;澳门&quot;</span>
        ax<span class="token punctuation">.</span>text<span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> name<span class="token punctuation">,</span> ha<span class="token operator">=</span><span class="token string">&quot;right&quot;</span><span class="token punctuation">,</span> va<span class="token operator">=</span><span class="token string">&quot;top&quot;</span><span class="token punctuation">,</span> fontdict<span class="token operator">=</span>fontdict<span class="token punctuation">)</span>
        gpd<span class="token punctuation">.</span>GeoSeries<span class="token punctuation">(</span>data<span class="token punctuation">.</span>iloc<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">.</span>geometry<span class="token punctuation">.</span>centroid<span class="token punctuation">)</span><span class="token punctuation">.</span>plot<span class="token punctuation">(</span>ax<span class="token operator">=</span>ax<span class="token punctuation">,</span> facecolor<span class="token operator">=</span><span class="token string">&#39;black&#39;</span><span class="token punctuation">,</span> markersize<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">)</span>

<span class="token comment">## 移除坐标轴</span>
ax<span class="token punctuation">.</span>axis<span class="token punctuation">(</span><span class="token string">&#39;off&#39;</span><span class="token punctuation">)</span>

<span class="token comment">## 单独绘制图例</span>
plt<span class="token punctuation">.</span>rcParams<span class="token punctuation">[</span><span class="token string">&quot;font.family&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">&#39;FZSongYi-Z13S&#39;</span>
ax<span class="token punctuation">.</span>scatter<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> c<span class="token operator">=</span><span class="token string">&#39;red&#39;</span><span class="token punctuation">,</span> s<span class="token operator">=</span><span class="token number">80</span><span class="token punctuation">,</span>  marker<span class="token operator">=</span><span class="token string">&#39;*&#39;</span><span class="token punctuation">,</span> label<span class="token operator">=</span><span class="token string">&#39;首都&#39;</span><span class="token punctuation">)</span>
ax<span class="token punctuation">.</span>plot<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> c<span class="token operator">=</span><span class="token string">&#39;grey&#39;</span><span class="token punctuation">,</span>linewidth<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">,</span> label<span class="token operator">=</span><span class="token string">&#39;南海九段线&#39;</span><span class="token punctuation">)</span> 
<span class="token comment">## 设置图例顺序</span>
handles<span class="token punctuation">,</span> labels <span class="token operator">=</span> ax<span class="token punctuation">.</span>get_legend_handles_labels<span class="token punctuation">(</span><span class="token punctuation">)</span>
ax<span class="token punctuation">.</span>legend<span class="token punctuation">(</span>handles<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> labels<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> title<span class="token operator">=</span><span class="token string">&quot;图例&quot;</span><span class="token punctuation">,</span>frameon<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> shadow<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> loc<span class="token operator">=</span><span class="token string">&quot;lower left&quot;</span><span class="token punctuation">,</span>fontsize<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">)</span>
<span class="token comment">## ax.legend(title=&quot;图例&quot;,frameon=True, shadow=True, loc=&quot;lower left&quot;,fontsize=10)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><pre><code>&lt;matplotlib.legend.Legend at 0x7f159cbe7510&gt;
</code></pre><figure><img src="https://gitlab.com/luohenyueji/article_picture_warehouse/-/raw/main/Python-Study-Notes/Mapping/[数据分析与可视化] Python绘制数据地图2-GeoPandas地图可视化/output_47_1.png" alt="png" tabindex="0" loading="lazy"><figcaption>png</figcaption></figure><p><strong>5 小地图绘制</strong></p><p>在很多中国地图中，南海诸岛区域都是在右下角的小地图单独绘制。在GeoPandas中想要实现这一功能，可以通过matplotlib的add_axes函数实现。add_axes主要功能为为新增绘图子区域，该区域可以位于画布中任意区域，且可设置任意大小。add_axes输入参数为(left, bottom, width, height)，left, bottom表示相对画布的比例坐标，width和height表示相对画布的比例长宽。</p><p>这种绘图方式非常不专业，也不推荐，建议只是学习使用思路。具体使用看如下代码。</p><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code><span class="token comment">## 创建画布</span>
fig <span class="token operator">=</span> plt<span class="token punctuation">.</span>figure<span class="token punctuation">(</span>figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment">## 创建一个填充整个画布的子图</span>
ax <span class="token operator">=</span> fig<span class="token punctuation">.</span>add_axes<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment">## 从画布宽40%，高40%处绘制子图 </span>
ax_child <span class="token operator">=</span> fig<span class="token punctuation">.</span>add_axes<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">0.4</span><span class="token punctuation">,</span><span class="token number">0.4</span><span class="token punctuation">,</span><span class="token number">0.2</span><span class="token punctuation">,</span><span class="token number">0.2</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="https://gitlab.com/luohenyueji/article_picture_warehouse/-/raw/main/Python-Study-Notes/Mapping/[数据分析与可视化] Python绘制数据地图2-GeoPandas地图可视化/output_49_0.png" alt="png" tabindex="0" loading="lazy"><figcaption>png</figcaption></figure><p>具体添加小地图首先确定中国大陆区域范围和南海范围，然后分开绘制。</p><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code><span class="token keyword">from</span> shapely<span class="token punctuation">.</span>geometry <span class="token keyword">import</span> Point

<span class="token comment">## 设中国大陆区域范围和南海范围，估计得到</span>
bound <span class="token operator">=</span> gpd<span class="token punctuation">.</span>GeoDataFrame<span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token string">&#39;x&#39;</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">80</span><span class="token punctuation">,</span> <span class="token number">140</span><span class="token punctuation">,</span> <span class="token number">106.5</span><span class="token punctuation">,</span> <span class="token number">123</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token string">&#39;y&#39;</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">15</span><span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">,</span> <span class="token number">2.8</span><span class="token punctuation">,</span> <span class="token number">24.5</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
bound<span class="token punctuation">.</span>geometry <span class="token operator">=</span> bound<span class="token punctuation">.</span><span class="token builtin">apply</span><span class="token punctuation">(</span><span class="token keyword">lambda</span> row<span class="token punctuation">:</span> Point<span class="token punctuation">(</span><span class="token punctuation">[</span>row<span class="token punctuation">[</span><span class="token string">&#39;x&#39;</span><span class="token punctuation">]</span><span class="token punctuation">,</span> row<span class="token punctuation">[</span><span class="token string">&#39;y&#39;</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> axis<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>
<span class="token comment">## 初始化CRS</span>
bound<span class="token punctuation">.</span>crs <span class="token operator">=</span> <span class="token string">&#39;EPSG:4326&#39;</span>
bound <span class="token operator">=</span> bound<span class="token punctuation">.</span>to_crs<span class="token punctuation">(</span><span class="token string">&#39;EPSG:4573&#39;</span><span class="token punctuation">)</span>
bound
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div><table border="1" class="dataframe"><thead><tr style="text-align:right;"><th></th><th>x</th><th>y</th><th>geometry</th></tr></thead><tbody><tr><th>0</th><td>80.0</td><td>15.0</td><td>POINT (15734050.166 1822879.627)</td></tr><tr><th>1</th><td>140.0</td><td>50.0</td><td>POINT (20972709.719 6154280.305)</td></tr><tr><th>2</th><td>106.5</td><td>2.8</td><td>POINT (18666803.134 309722.667)</td></tr><tr><th>3</th><td>123.0</td><td>24.5</td><td>POINT (20344370.888 2833592.614)</td></tr></tbody></table></div><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code><span class="token comment">## 创建画布matplotlib</span>
fig<span class="token punctuation">,</span> ax <span class="token operator">=</span> plt<span class="token punctuation">.</span>subplots<span class="token punctuation">(</span>figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">12</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment">## 绘制主要区域</span>
ax <span class="token operator">=</span> data<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>ax<span class="token operator">=</span>ax<span class="token punctuation">,</span>facecolor<span class="token operator">=</span><span class="token string">&#39;grey&#39;</span><span class="token punctuation">,</span>edgecolor<span class="token operator">=</span><span class="token string">&#39;lightgrey&#39;</span><span class="token punctuation">,</span>alpha<span class="token operator">=</span><span class="token number">0.8</span><span class="token punctuation">,</span>linewidth<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>
<span class="token comment">## 绘制九段线</span>
ax <span class="token operator">=</span> gpd<span class="token punctuation">.</span>GeoSeries<span class="token punctuation">(</span>nine_dotted_line<span class="token punctuation">.</span>geometry<span class="token punctuation">)</span><span class="token punctuation">.</span>plot<span class="token punctuation">(</span>ax<span class="token operator">=</span>ax<span class="token punctuation">,</span>edgecolor<span class="token operator">=</span><span class="token string">&#39;grey&#39;</span><span class="token punctuation">,</span>linewidth<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">)</span>
<span class="token comment">## 强调首都</span>
ax <span class="token operator">=</span> data<span class="token punctuation">[</span>data<span class="token punctuation">.</span>name<span class="token operator">==</span><span class="token string">&quot;北京市&quot;</span><span class="token punctuation">]</span><span class="token punctuation">.</span>representative_point<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>plot<span class="token punctuation">(</span>ax<span class="token operator">=</span>ax<span class="token punctuation">,</span> facecolor<span class="token operator">=</span><span class="token string">&#39;red&#39;</span><span class="token punctuation">,</span>marker<span class="token operator">=</span><span class="token string">&#39;*&#39;</span><span class="token punctuation">,</span> markersize<span class="token operator">=</span><span class="token number">150</span><span class="token punctuation">)</span> 

<span class="token comment">## 强调港澳台</span>
<span class="token comment">## 设置字体</span>
fontdict <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">&#39;family&#39;</span><span class="token punctuation">:</span><span class="token string">&#39;FZSongYi-Z13S&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;size&#39;</span><span class="token punctuation">:</span><span class="token number">8</span><span class="token punctuation">,</span> <span class="token string">&#39;color&#39;</span><span class="token punctuation">:</span> <span class="token string">&quot;blue&quot;</span><span class="token punctuation">,</span><span class="token string">&#39;weight&#39;</span><span class="token punctuation">:</span> <span class="token string">&#39;bold&#39;</span><span class="token punctuation">}</span>
<span class="token comment">## 这一段代码可能因为不同matplotlib版本出现不同结果</span>
<span class="token keyword">for</span> index <span class="token keyword">in</span> data<span class="token punctuation">[</span>data<span class="token punctuation">.</span>adcode<span class="token punctuation">.</span>isin<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">&#39;710000&#39;</span><span class="token punctuation">,</span><span class="token string">&#39;810000&#39;</span><span class="token punctuation">,</span><span class="token string">&#39;820000&#39;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">.</span>index<span class="token punctuation">:</span>
    <span class="token keyword">if</span> data<span class="token punctuation">.</span>iloc<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">&#39;name&#39;</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">&quot;台湾省&quot;</span><span class="token punctuation">:</span>
        x <span class="token operator">=</span> data<span class="token punctuation">.</span>iloc<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">.</span>geometry<span class="token punctuation">.</span>centroid<span class="token punctuation">.</span>x
        y <span class="token operator">=</span> data<span class="token punctuation">.</span>iloc<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">.</span>geometry<span class="token punctuation">.</span>centroid<span class="token punctuation">.</span>y
        name <span class="token operator">=</span> <span class="token string">&quot;台湾省&quot;</span>
        ax<span class="token punctuation">.</span>text<span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> name<span class="token punctuation">,</span> ha<span class="token operator">=</span><span class="token string">&quot;center&quot;</span><span class="token punctuation">,</span> va<span class="token operator">=</span><span class="token string">&quot;center&quot;</span><span class="token punctuation">,</span> fontdict<span class="token operator">=</span>fontdict<span class="token punctuation">)</span>
    <span class="token keyword">elif</span> data<span class="token punctuation">.</span>iloc<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">&#39;name&#39;</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">&quot;香港特别行政区&quot;</span><span class="token punctuation">:</span>
        x <span class="token operator">=</span> data<span class="token punctuation">.</span>iloc<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">.</span>geometry<span class="token punctuation">.</span>centroid<span class="token punctuation">.</span>x
        y <span class="token operator">=</span> data<span class="token punctuation">.</span>iloc<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">.</span>geometry<span class="token punctuation">.</span>centroid<span class="token punctuation">.</span>y
        name <span class="token operator">=</span> <span class="token string">&quot;香港&quot;</span>
        ax<span class="token punctuation">.</span>text<span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> name<span class="token punctuation">,</span> ha<span class="token operator">=</span><span class="token string">&quot;left&quot;</span><span class="token punctuation">,</span> va<span class="token operator">=</span><span class="token string">&quot;top&quot;</span><span class="token punctuation">,</span> fontdict<span class="token operator">=</span>fontdict<span class="token punctuation">)</span>
        gpd<span class="token punctuation">.</span>GeoSeries<span class="token punctuation">(</span>data<span class="token punctuation">.</span>iloc<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">.</span>geometry<span class="token punctuation">.</span>centroid<span class="token punctuation">)</span><span class="token punctuation">.</span>plot<span class="token punctuation">(</span>ax<span class="token operator">=</span>ax<span class="token punctuation">,</span> facecolor<span class="token operator">=</span><span class="token string">&#39;black&#39;</span><span class="token punctuation">,</span> markersize<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">)</span>
    <span class="token keyword">elif</span> data<span class="token punctuation">.</span>iloc<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">&#39;name&#39;</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">&quot;澳门特别行政区&quot;</span><span class="token punctuation">:</span>
        x <span class="token operator">=</span> data<span class="token punctuation">.</span>iloc<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">.</span>geometry<span class="token punctuation">.</span>centroid<span class="token punctuation">.</span>x
        y <span class="token operator">=</span> data<span class="token punctuation">.</span>iloc<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">.</span>geometry<span class="token punctuation">.</span>centroid<span class="token punctuation">.</span>y
        name <span class="token operator">=</span> <span class="token string">&quot;澳门&quot;</span>
        ax<span class="token punctuation">.</span>text<span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> name<span class="token punctuation">,</span> ha<span class="token operator">=</span><span class="token string">&quot;right&quot;</span><span class="token punctuation">,</span> va<span class="token operator">=</span><span class="token string">&quot;top&quot;</span><span class="token punctuation">,</span> fontdict<span class="token operator">=</span>fontdict<span class="token punctuation">)</span>
        gpd<span class="token punctuation">.</span>GeoSeries<span class="token punctuation">(</span>data<span class="token punctuation">.</span>iloc<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">.</span>geometry<span class="token punctuation">.</span>centroid<span class="token punctuation">)</span><span class="token punctuation">.</span>plot<span class="token punctuation">(</span>ax<span class="token operator">=</span>ax<span class="token punctuation">,</span> facecolor<span class="token operator">=</span><span class="token string">&#39;black&#39;</span><span class="token punctuation">,</span> markersize<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">)</span>

<span class="token comment">## 设置大陆区域范围</span>
ax<span class="token punctuation">.</span>set_xlim<span class="token punctuation">(</span>bound<span class="token punctuation">.</span>geometry<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>x<span class="token punctuation">,</span> bound<span class="token punctuation">.</span>geometry<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>x<span class="token punctuation">)</span>
ax<span class="token punctuation">.</span>set_ylim<span class="token punctuation">(</span>bound<span class="token punctuation">.</span>geometry<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>y<span class="token punctuation">,</span> bound<span class="token punctuation">.</span>geometry<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>y<span class="token punctuation">)</span>

<span class="token comment">## 移除坐标轴</span>
ax<span class="token punctuation">.</span>axis<span class="token punctuation">(</span><span class="token string">&#39;off&#39;</span><span class="token punctuation">)</span>

<span class="token comment">## 单独绘制图例</span>
plt<span class="token punctuation">.</span>rcParams<span class="token punctuation">[</span><span class="token string">&quot;font.family&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">&#39;FZSongYi-Z13S&#39;</span>
ax<span class="token punctuation">.</span>scatter<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> c<span class="token operator">=</span><span class="token string">&#39;red&#39;</span><span class="token punctuation">,</span> s<span class="token operator">=</span><span class="token number">80</span><span class="token punctuation">,</span>  marker<span class="token operator">=</span><span class="token string">&#39;*&#39;</span><span class="token punctuation">,</span> label<span class="token operator">=</span><span class="token string">&#39;首都&#39;</span><span class="token punctuation">)</span>
ax<span class="token punctuation">.</span>plot<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> c<span class="token operator">=</span><span class="token string">&#39;grey&#39;</span><span class="token punctuation">,</span>linewidth<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">,</span> label<span class="token operator">=</span><span class="token string">&#39;南海九段线&#39;</span><span class="token punctuation">)</span> 
<span class="token comment">## 设置图例顺序</span>
handles<span class="token punctuation">,</span> labels <span class="token operator">=</span> ax<span class="token punctuation">.</span>get_legend_handles_labels<span class="token punctuation">(</span><span class="token punctuation">)</span>
ax<span class="token punctuation">.</span>legend<span class="token punctuation">(</span>handles<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> labels<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> title<span class="token operator">=</span><span class="token string">&quot;图例&quot;</span><span class="token punctuation">,</span>frameon<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> shadow<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> loc<span class="token operator">=</span><span class="token string">&quot;lower left&quot;</span><span class="token punctuation">,</span>fontsize<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">)</span>
<span class="token comment">## ax.legend(title=&quot;图例&quot;,frameon=True, shadow=True, loc=&quot;lower left&quot;,fontsize=10)</span>

<span class="token comment">## 创建南海插图对应的子图，调整这些参数以调整地图位置</span>
ax_child <span class="token operator">=</span> fig<span class="token punctuation">.</span>add_axes<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">0.75</span><span class="token punctuation">,</span> <span class="token number">0.15</span><span class="token punctuation">,</span> <span class="token number">0.2</span><span class="token punctuation">,</span> <span class="token number">0.2</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
ax_child <span class="token operator">=</span> data<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>ax<span class="token operator">=</span>ax_child<span class="token punctuation">,</span>facecolor<span class="token operator">=</span><span class="token string">&#39;grey&#39;</span><span class="token punctuation">,</span>edgecolor<span class="token operator">=</span><span class="token string">&#39;lightgrey&#39;</span><span class="token punctuation">,</span>alpha<span class="token operator">=</span><span class="token number">0.8</span><span class="token punctuation">,</span>linewidth<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>
<span class="token comment">## 绘制九段线</span>
ax_child <span class="token operator">=</span> gpd<span class="token punctuation">.</span>GeoSeries<span class="token punctuation">(</span>nine_dotted_line<span class="token punctuation">.</span>geometry<span class="token punctuation">)</span><span class="token punctuation">.</span>plot<span class="token punctuation">(</span>ax<span class="token operator">=</span>ax_child<span class="token punctuation">,</span>edgecolor<span class="token operator">=</span><span class="token string">&#39;grey&#39;</span><span class="token punctuation">,</span>linewidth<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">)</span>

<span class="token comment">## 设置子图显示范围</span>
ax_child<span class="token punctuation">.</span>set_xlim<span class="token punctuation">(</span>bound<span class="token punctuation">.</span>geometry<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">.</span>x<span class="token punctuation">,</span> bound<span class="token punctuation">.</span>geometry<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">.</span>x<span class="token punctuation">)</span>
ax_child<span class="token punctuation">.</span>set_ylim<span class="token punctuation">(</span>bound<span class="token punctuation">.</span>geometry<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">.</span>y<span class="token punctuation">,</span> bound<span class="token punctuation">.</span>geometry<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">.</span>y<span class="token punctuation">)</span>
ax_child<span class="token punctuation">.</span>text<span class="token punctuation">(</span><span class="token number">0.98</span><span class="token punctuation">,</span><span class="token number">0.02</span><span class="token punctuation">,</span><span class="token string">&#39;Produced by luohenyueji&#39;</span><span class="token punctuation">,</span>transform <span class="token operator">=</span> ax<span class="token punctuation">.</span>transAxes<span class="token punctuation">,</span>
        ha<span class="token operator">=</span><span class="token string">&#39;center&#39;</span><span class="token punctuation">,</span> va<span class="token operator">=</span><span class="token string">&#39;center&#39;</span><span class="token punctuation">,</span>fontsize <span class="token operator">=</span> <span class="token number">12</span><span class="token punctuation">,</span>color<span class="token operator">=</span><span class="token string">&#39;black&#39;</span><span class="token punctuation">)</span>
<span class="token comment">## 移除子图坐标轴</span>
ax_child<span class="token punctuation">.</span>set_xticks<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
ax_child<span class="token punctuation">.</span>set_yticks<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

fig<span class="token punctuation">.</span>savefig<span class="token punctuation">(</span><span class="token string">&#39;res.png&#39;</span><span class="token punctuation">,</span> dpi<span class="token operator">=</span><span class="token number">300</span><span class="token punctuation">,</span> bbox_inches<span class="token operator">=</span><span class="token string">&#39;tight&#39;</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="https://gitlab.com/luohenyueji/article_picture_warehouse/-/raw/main/Python-Study-Notes/Mapping/[数据分析与可视化] Python绘制数据地图2-GeoPandas地图可视化/output_52_0.png" alt="png" tabindex="0" loading="lazy"><figcaption>png</figcaption></figure><h2 id="_2-分层设色" tabindex="-1"><a class="header-anchor" href="#_2-分层设色" aria-hidden="true">#</a> 2 分层设色</h2><h3 id="_2-1-分层设色基本介绍" tabindex="-1"><a class="header-anchor" href="#_2-1-分层设色基本介绍" aria-hidden="true">#</a> 2.1 分层设色基本介绍</h3><p>如下代码所示，绘制江苏省地级市GDP地图。</p><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code><span class="token comment">## 读取2019江苏省各市GDP数据</span>

<span class="token keyword">import</span> geopandas <span class="token keyword">as</span> gpd
<span class="token keyword">import</span> matplotlib<span class="token punctuation">.</span>pyplot <span class="token keyword">as</span> plt
<span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd
plt<span class="token punctuation">.</span>rcParams<span class="token punctuation">[</span><span class="token string">&quot;font.family&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">&#39;FZSongYi-Z13S&#39;</span>
<span class="token comment">## 数据来自互联网</span>
gdp <span class="token operator">=</span> pd<span class="token punctuation">.</span>read_csv<span class="token punctuation">(</span><span class="token string">&quot;2022江苏省各市GDP.csv&quot;</span><span class="token punctuation">)</span>
gdp
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div><table border="1" class="dataframe"><thead><tr style="text-align:right;"><th></th><th>排行</th><th>地级市</th><th>2022年GDP（亿元）</th></tr></thead><tbody><tr><th>0</th><td>1</td><td>苏州市</td><td>23958.3</td></tr><tr><th>1</th><td>2</td><td>南京市</td><td>16907.9</td></tr><tr><th>2</th><td>3</td><td>无锡市</td><td>14850.8</td></tr><tr><th>3</th><td>4</td><td>南通市</td><td>11379.6</td></tr><tr><th>4</th><td>5</td><td>常州市</td><td>9550.1</td></tr><tr><th>5</th><td>6</td><td>徐州市</td><td>8457.8</td></tr><tr><th>6</th><td>7</td><td>盐城市</td><td>7079.8</td></tr><tr><th>7</th><td>8</td><td>扬州市</td><td>6696.4</td></tr><tr><th>8</th><td>9</td><td>泰州市</td><td>6401.8</td></tr><tr><th>9</th><td>10</td><td>镇江市</td><td>5017.0</td></tr><tr><th>10</th><td>11</td><td>淮安市</td><td>4742.4</td></tr><tr><th>11</th><td>12</td><td>宿迁市</td><td>4112.0</td></tr><tr><th>12</th><td>13</td><td>连云港市</td><td>4005.0</td></tr></tbody></table></div><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code><span class="token comment">## 读取江苏地图数据，数据来自DataV.GeoAtlas，将其投影到EPSG:4573</span>
data <span class="token operator">=</span> gpd<span class="token punctuation">.</span>read_file<span class="token punctuation">(</span><span class="token string">&#39;https://geo.datav.aliyun.com/areas_v3/bound/320000_full.json&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>to_crs<span class="token punctuation">(</span><span class="token string">&#39;EPSG:4573&#39;</span><span class="token punctuation">)</span>
<span class="token comment">## 合并数据</span>
data <span class="token operator">=</span> data<span class="token punctuation">.</span>join<span class="token punctuation">(</span>gdp<span class="token punctuation">.</span>set_index<span class="token punctuation">(</span><span class="token string">&#39;地级市&#39;</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token string">&quot;2022年GDP（亿元）&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>on<span class="token operator">=</span><span class="token string">&#39;name&#39;</span><span class="token punctuation">)</span>
<span class="token comment">## 修改列名</span>
data<span class="token punctuation">.</span>rename<span class="token punctuation">(</span>columns<span class="token operator">=</span><span class="token punctuation">{</span><span class="token string">&#39;2022年GDP（亿元）&#39;</span><span class="token punctuation">:</span><span class="token string">&#39;GDP&#39;</span><span class="token punctuation">}</span><span class="token punctuation">,</span>inplace<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
data<span class="token punctuation">.</span>head<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div><table border="1" class="dataframe"><thead><tr style="text-align:right;"><th></th><th>adcode</th><th>name</th><th>childrenNum</th><th>level</th><th>parent</th><th>subFeatureIndex</th><th>geometry</th><th>GDP</th></tr></thead><tbody><tr><th>0</th><td>320100</td><td>南京市</td><td>11</td><td>city</td><td>{&#39;adcode&#39;: 320000}</td><td>0</td><td>MULTIPOLYGON (((19828216.260 3681802.361, 1982...</td><td>16907.9</td></tr><tr><th>1</th><td>320200</td><td>无锡市</td><td>7</td><td>city</td><td>{&#39;adcode&#39;: 320000}</td><td>1</td><td>MULTIPOLYGON (((19892555.472 3541293.638, 1989...</td><td>14850.8</td></tr><tr><th>2</th><td>320300</td><td>徐州市</td><td>10</td><td>city</td><td>{&#39;adcode&#39;: 320000}</td><td>2</td><td>MULTIPOLYGON (((19736418.457 3894748.096, 1973...</td><td>8457.8</td></tr><tr><th>3</th><td>320400</td><td>常州市</td><td>6</td><td>city</td><td>{&#39;adcode&#39;: 320000}</td><td>3</td><td>MULTIPOLYGON (((19927182.917 3638819.801, 1992...</td><td>9550.1</td></tr><tr><th>4</th><td>320500</td><td>苏州市</td><td>9</td><td>city</td><td>{&#39;adcode&#39;: 320000}</td><td>4</td><td>MULTIPOLYGON (((19929872.531 3547724.116, 1993...</td><td>23958.3</td></tr></tbody></table></div><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code>fig<span class="token punctuation">,</span> ax <span class="token operator">=</span> plt<span class="token punctuation">.</span>subplots<span class="token punctuation">(</span>figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment">## legend_kwds设置matplotlib的legend参数</span>
data<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>ax<span class="token operator">=</span>ax<span class="token punctuation">,</span>column<span class="token operator">=</span><span class="token string">&#39;GDP&#39;</span><span class="token punctuation">,</span> cmap<span class="token operator">=</span><span class="token string">&#39;coolwarm&#39;</span><span class="token punctuation">,</span> legend<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span>legend_kwds<span class="token operator">=</span><span class="token punctuation">{</span><span class="token string">&#39;label&#39;</span><span class="token punctuation">:</span> <span class="token string">&quot;GDP（亿元）&quot;</span><span class="token punctuation">,</span> <span class="token string">&#39;shrink&#39;</span><span class="token punctuation">:</span><span class="token number">0.5</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
ax<span class="token punctuation">.</span>axis<span class="token punctuation">(</span><span class="token string">&#39;off&#39;</span><span class="token punctuation">)</span>

<span class="token comment">## 设置</span>
fontdict <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">&#39;family&#39;</span><span class="token punctuation">:</span><span class="token string">&#39;FZSongYi-Z13S&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;size&#39;</span><span class="token punctuation">:</span><span class="token number">8</span><span class="token punctuation">,</span> <span class="token string">&#39;color&#39;</span><span class="token punctuation">:</span> <span class="token string">&quot;black&quot;</span><span class="token punctuation">,</span><span class="token string">&#39;weight&#39;</span><span class="token punctuation">:</span> <span class="token string">&#39;bold&#39;</span><span class="token punctuation">}</span>

<span class="token comment">## 设置标题</span>
ax<span class="token punctuation">.</span>set_title<span class="token punctuation">(</span><span class="token string">&#39;江苏省地级市2022年GDP数据可视化&#39;</span><span class="token punctuation">,</span> fontsize<span class="token operator">=</span><span class="token number">24</span><span class="token punctuation">)</span> 
<span class="token keyword">for</span> index <span class="token keyword">in</span> data<span class="token punctuation">.</span>index<span class="token punctuation">:</span>
    x <span class="token operator">=</span> data<span class="token punctuation">.</span>iloc<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">.</span>geometry<span class="token punctuation">.</span>centroid<span class="token punctuation">.</span>x
    y <span class="token operator">=</span> data<span class="token punctuation">.</span>iloc<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">.</span>geometry<span class="token punctuation">.</span>centroid<span class="token punctuation">.</span>y
    name <span class="token operator">=</span> data<span class="token punctuation">.</span>iloc<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">]</span>
    <span class="token keyword">if</span> name <span class="token keyword">in</span> <span class="token punctuation">[</span><span class="token string">&quot;苏州市&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;无锡市&quot;</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
        x <span class="token operator">=</span> x<span class="token operator">*</span><span class="token number">1.001</span>
    ax<span class="token punctuation">.</span>text<span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> name<span class="token punctuation">,</span> ha<span class="token operator">=</span><span class="token string">&quot;center&quot;</span><span class="token punctuation">,</span> va<span class="token operator">=</span><span class="token string">&quot;center&quot;</span><span class="token punctuation">,</span> fontdict<span class="token operator">=</span>fontdict<span class="token punctuation">)</span>
<span class="token comment">## 保存图片</span>
fig<span class="token punctuation">.</span>savefig<span class="token punctuation">(</span><span class="token string">&#39;res.png&#39;</span><span class="token punctuation">,</span> dpi<span class="token operator">=</span><span class="token number">300</span><span class="token punctuation">,</span> bbox_inches<span class="token operator">=</span><span class="token string">&#39;tight&#39;</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="https://gitlab.com/luohenyueji/article_picture_warehouse/-/raw/main/Python-Study-Notes/Mapping/[数据分析与可视化] Python绘制数据地图2-GeoPandas地图可视化/output_56_0.png" alt="png" tabindex="0" loading="lazy"><figcaption>png</figcaption></figure><p>可以看到在上述地图中，由于苏州市的数值太大，其他数据被压缩到浅色区域，无法有效展示数据分布。需要使用地图分层设色来更好地展示数据。地图分层设色是一种常见的地图可视化方式，它可以将地图上的数据按照不同的分类进行分层，并对每一层数据进行不同的颜色设定，以便更加直观地展现地理空间数据的分布情况和特征。 在本文通过Python模块mapclassify用于分层设色和数据可视化。使用mapclassify之前需要输入以下命令安装相关模块：</p><blockquote><p>pip install mapclassify</p></blockquote>`,42),w={href:"https://github.com/pysal/mapclassify",target:"_blank",rel:"noopener noreferrer"},P=p("<ul><li><code>BoxPlot</code>: 基于箱线图的分类方法。这种分类方法适用于数据分布比较规律的情况。</li><li><code>EqualInterval</code>: 等距离分类方法。这种分类方法将数据划分为等距离的若干区间。适用于数据分布比较均匀的情况。</li><li><code>FisherJenks</code>: 基于Fisher-Jenks算法的分类方法。这种分类方法将数据划分为若干区间，使得每个区间内部的差异最小，不同区间之间的差异最大。适用于数据分布比较不规律的情况。</li><li><code>HeadTailBreaks</code>: 基于Head-Tail算法的分类方法。这种分类方法将给定的数据集分为两部分：头部和尾部。头部通常包含出现频率最高的值，而尾部包含出现频率较低的值。适用于识别数据集中的异常值和离群值。</li><li><code>JenksCaspall</code>: 基于Jenks-Caspall算法的分类方法。这种分类方法根据数据中发现的自然分组将数据集划分为类。适用于需要将数据分类为几个具有明显含义的区间的情况。</li><li><code>JenksCaspallForced</code>: 强制基于Jenks-Caspall算法的分类方法。与JenksCaspall算法类似，但是它对区间的数量和大小有更强的控制力。适用于需要精确控制区间数量和大小的情况。</li><li><code>JenksCaspallSampled</code>: 采样基于Jenks-Caspall算法的分类方法。该方法对数据进行采样，然后使用Jenks-Caspall算法对采样后的数据进行分类，适用于数据量比较大的情况。</li><li><code>MaxP</code>: 基于最大界限的分类方法。这种分类方法将数据划分为几个区间，使得不同区间之间的差异最大。适用于需要将数据分类为几个具有明显差异的区间的情况。</li><li><code>MaximumBreaks</code>: 基于最大间隔的分类方法。这种分类方法与MaxP算法类似，但是它更加注重区间的可理解性。适用于需要将数据分类为几个具有明显含义的区间的情况。</li><li><code>NaturalBreaks</code>: 基于自然间隔的分类方法。这种分类方法将数据划分为几个区间，使得每个区间内部的差异最小，不同区间之间的差异最大。适用于数据分布比较不规律的情况</li><li><code>Quantiles</code>: 基于分位数的分类方法。</li><li><code>Percentiles</code>: 基于百分位数的分类方法。</li><li><code>StdMean</code>: 基于标准差分组的分类方法。</li><li><code>UserDefined</code>: 基于自定义分组的分类方法。</li></ul>",1),q={href:"https://www.cnblogs.com/feffery/p/12381322.html",target:"_blank",rel:"noopener noreferrer"},G=p(`<p><strong>示例1</strong></p><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code><span class="token keyword">import</span> mapclassify
<span class="token comment">## 导入示例数据</span>
y <span class="token operator">=</span> mapclassify<span class="token punctuation">.</span>load_example<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token punctuation">(</span>y<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>y<span class="token punctuation">.</span>mean<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>y<span class="token punctuation">.</span><span class="token builtin">min</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> y<span class="token punctuation">.</span><span class="token builtin">max</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
y<span class="token punctuation">.</span>head<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><pre><code>&lt;class &#39;pandas.core.series.Series&#39;&gt;
125.92810344827588 0.13 4111.45





0    329.92
1      0.42
2      5.90
3     14.03
4      2.78
Name: emp/sq km, dtype: float64
</code></pre><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code>mapclassify<span class="token punctuation">.</span>EqualInterval<span class="token punctuation">(</span>y<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><pre><code>EqualInterval

     Interval        Count
--------------------------
[   0.13,  822.39] |    57
( 822.39, 1644.66] |     0
(1644.66, 2466.92] |     0
(2466.92, 3289.19] |     0
(3289.19, 4111.45] |     1
</code></pre><p><strong>示例2</strong></p><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code>y <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">,</span><span class="token number">7</span><span class="token punctuation">,</span><span class="token number">8</span><span class="token punctuation">,</span><span class="token number">9</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">]</span>
<span class="token comment">## 分为四个区间</span>
mapclassify<span class="token punctuation">.</span>JenksCaspall<span class="token punctuation">(</span>y<span class="token punctuation">,</span> k<span class="token operator">=</span><span class="token number">4</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><pre><code>JenksCaspall

  Interval     Count
--------------------
[0.00, 2.00] |     3
(2.00, 4.00] |     2
(4.00, 6.00] |     2
(6.00, 9.00] |     3
</code></pre><p><strong>示例3</strong></p><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code>y <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">,</span><span class="token number">7</span><span class="token punctuation">,</span><span class="token number">8</span><span class="token punctuation">,</span><span class="token number">9</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">]</span>
<span class="token comment">## 自定义区间</span>
mapclassify<span class="token punctuation">.</span>UserDefined<span class="token punctuation">(</span>y<span class="token punctuation">,</span> bins<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><pre><code>UserDefined

  Interval     Count
--------------------
[0.00, 5.00] |     6
(5.00, 8.00] |     3
(8.00, 9.00] |     1
</code></pre><p><strong>示例4</strong></p><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code><span class="token keyword">import</span> mapclassify 
<span class="token keyword">import</span> pandas
<span class="token keyword">from</span> numpy <span class="token keyword">import</span> linspace <span class="token keyword">as</span> lsp
demo <span class="token operator">=</span> <span class="token punctuation">[</span>lsp<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">8</span><span class="token punctuation">,</span>num<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">,</span> lsp<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> num<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">,</span> lsp<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">15</span><span class="token punctuation">,</span> num<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
demo <span class="token operator">=</span> pandas<span class="token punctuation">.</span>DataFrame<span class="token punctuation">(</span>demo<span class="token punctuation">)</span><span class="token punctuation">.</span>T
demo<span class="token punctuation">.</span>head<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div><table border="1" class="dataframe"><thead><tr style="text-align:right;"><th></th><th>0</th><th>1</th><th>2</th></tr></thead><tbody><tr><th>0</th><td>3.000000</td><td>10.000000</td><td>-5.000000</td></tr><tr><th>1</th><td>3.555556</td><td>8.888889</td><td>-2.777778</td></tr><tr><th>2</th><td>4.111111</td><td>7.777778</td><td>-0.555556</td></tr><tr><th>3</th><td>4.666667</td><td>6.666667</td><td>1.666667</td></tr><tr><th>4</th><td>5.222222</td><td>5.555556</td><td>3.888889</td></tr></tbody></table></div><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code><span class="token comment">## 使用apply函数应用分层，rolling表示是否进行滑动窗口计算以消除随机波动</span>
demo<span class="token punctuation">.</span><span class="token builtin">apply</span><span class="token punctuation">(</span>mapclassify<span class="token punctuation">.</span>Quantiles<span class="token punctuation">.</span>make<span class="token punctuation">(</span>rolling<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>head<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><div><table border="1" class="dataframe"><thead><tr style="text-align:right;"><th></th><th>0</th><th>1</th><th>2</th></tr></thead><tbody><tr><th>0</th><td>0</td><td>4</td><td>0</td></tr><tr><th>1</th><td>0</td><td>4</td><td>0</td></tr><tr><th>2</th><td>1</td><td>4</td><td>0</td></tr><tr><th>3</th><td>1</td><td>3</td><td>0</td></tr><tr><th>4</th><td>2</td><td>2</td><td>1</td></tr></tbody></table></div><h3 id="_2-2-绘图实例之用于地图的分层设色" tabindex="-1"><a class="header-anchor" href="#_2-2-绘图实例之用于地图的分层设色" aria-hidden="true">#</a> 2.2 绘图实例之用于地图的分层设色</h3><p><strong>方法1</strong></p><p>GeoPandas中分层设色可以通过plot函数中的scheme参数和k参数设置数据分层方式和分层类别数。如下所示，通过JenksCaspall将GDP数据分为4级，可以直观看到GDP数据在第一梯队的城市有哪些。</p><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code>fig<span class="token punctuation">,</span> ax <span class="token operator">=</span> plt<span class="token punctuation">.</span>subplots<span class="token punctuation">(</span>figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment">## 使用分层设色后,legend_kwds要进行相应修改</span>
data<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>ax<span class="token operator">=</span>ax<span class="token punctuation">,</span>column<span class="token operator">=</span><span class="token string">&#39;GDP&#39;</span><span class="token punctuation">,</span> cmap<span class="token operator">=</span><span class="token string">&#39;coolwarm&#39;</span><span class="token punctuation">,</span> legend<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span>scheme<span class="token operator">=</span><span class="token string">&#39;JenksCaspall&#39;</span><span class="token punctuation">,</span>k<span class="token operator">=</span><span class="token number">4</span><span class="token punctuation">,</span>legend_kwds<span class="token operator">=</span><span class="token punctuation">{</span>
                                                     <span class="token string">&#39;loc&#39;</span><span class="token punctuation">:</span> <span class="token string">&#39;lower left&#39;</span><span class="token punctuation">,</span>
                                                     <span class="token string">&#39;title&#39;</span><span class="token punctuation">:</span> <span class="token string">&#39;GDP数据分级（亿元）&#39;</span><span class="token punctuation">,</span>
                                                 <span class="token punctuation">}</span><span class="token punctuation">)</span>
ax<span class="token punctuation">.</span>axis<span class="token punctuation">(</span><span class="token string">&#39;off&#39;</span><span class="token punctuation">)</span>

<span class="token comment">## 设置</span>
fontdict <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">&#39;family&#39;</span><span class="token punctuation">:</span><span class="token string">&#39;FZSongYi-Z13S&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;size&#39;</span><span class="token punctuation">:</span><span class="token number">8</span><span class="token punctuation">,</span> <span class="token string">&#39;color&#39;</span><span class="token punctuation">:</span> <span class="token string">&quot;black&quot;</span><span class="token punctuation">,</span><span class="token string">&#39;weight&#39;</span><span class="token punctuation">:</span> <span class="token string">&#39;bold&#39;</span><span class="token punctuation">}</span>

<span class="token comment">## 设置标题</span>
ax<span class="token punctuation">.</span>set_title<span class="token punctuation">(</span><span class="token string">&#39;江苏省地级市2022年GDP数据可视化&#39;</span><span class="token punctuation">,</span> fontsize<span class="token operator">=</span><span class="token number">24</span><span class="token punctuation">)</span> 
<span class="token keyword">for</span> index <span class="token keyword">in</span> data<span class="token punctuation">.</span>index<span class="token punctuation">:</span>
    x <span class="token operator">=</span> data<span class="token punctuation">.</span>iloc<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">.</span>geometry<span class="token punctuation">.</span>centroid<span class="token punctuation">.</span>x
    y <span class="token operator">=</span> data<span class="token punctuation">.</span>iloc<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">.</span>geometry<span class="token punctuation">.</span>centroid<span class="token punctuation">.</span>y
    name <span class="token operator">=</span> data<span class="token punctuation">.</span>iloc<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">]</span>
    <span class="token keyword">if</span> name <span class="token keyword">in</span> <span class="token punctuation">[</span><span class="token string">&quot;苏州市&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;无锡市&quot;</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
        x <span class="token operator">=</span> x<span class="token operator">*</span><span class="token number">1.001</span>
    ax<span class="token punctuation">.</span>text<span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> name<span class="token punctuation">,</span> ha<span class="token operator">=</span><span class="token string">&quot;center&quot;</span><span class="token punctuation">,</span> va<span class="token operator">=</span><span class="token string">&quot;center&quot;</span><span class="token punctuation">,</span> fontdict<span class="token operator">=</span>fontdict<span class="token punctuation">)</span>
<span class="token comment">## 保存图片</span>
fig<span class="token punctuation">.</span>savefig<span class="token punctuation">(</span><span class="token string">&#39;res.png&#39;</span><span class="token punctuation">,</span> dpi<span class="token operator">=</span><span class="token number">300</span><span class="token punctuation">,</span> bbox_inches<span class="token operator">=</span><span class="token string">&#39;tight&#39;</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="https://gitlab.com/luohenyueji/article_picture_warehouse/-/raw/main/Python-Study-Notes/Mapping/[数据分析与可视化] Python绘制数据地图2-GeoPandas地图可视化/output_70_0.png" alt="png" tabindex="0" loading="lazy"><figcaption>png</figcaption></figure><p><strong>方法2</strong></p><p>在GeoPandas中也可以通过mapclassify直接处理数据，生成新的数据列进行展示。通过该种方式可以看到，苏州和南京的GDP领先于其他地级市。</p><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code><span class="token comment">## 创建分类器</span>
classifier <span class="token operator">=</span> mapclassify<span class="token punctuation">.</span>HeadTailBreaks<span class="token punctuation">(</span>data<span class="token punctuation">[</span><span class="token string">&#39;GDP&#39;</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
classifier
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><pre><code>HeadTailBreaks

      Interval         Count
----------------------------
[ 4005.00,  9473.76] |     8
( 9473.76, 15329.34] |     3
(15329.34, 20433.10] |     1
(20433.10, 23958.30] |     1
</code></pre><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code><span class="token comment">## 赋值数据</span>
data<span class="token punctuation">[</span><span class="token string">&#39;GDP_class&#39;</span><span class="token punctuation">]</span> <span class="token operator">=</span> data<span class="token punctuation">[</span><span class="token string">&#39;GDP&#39;</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token builtin">apply</span><span class="token punctuation">(</span>classifier<span class="token punctuation">)</span>
data<span class="token punctuation">[</span><span class="token string">&#39;GDP_class&#39;</span><span class="token punctuation">]</span> <span class="token operator">=</span> data<span class="token punctuation">[</span><span class="token string">&#39;GDP_class&#39;</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token builtin">apply</span><span class="token punctuation">(</span><span class="token keyword">lambda</span> x <span class="token punctuation">:</span> <span class="token builtin">int</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span>
data<span class="token punctuation">.</span>head<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div><table border="1" class="dataframe"><thead><tr style="text-align:right;"><th></th><th>adcode</th><th>name</th><th>childrenNum</th><th>level</th><th>parent</th><th>subFeatureIndex</th><th>geometry</th><th>GDP</th><th>GDP_class</th></tr></thead><tbody><tr><th>0</th><td>320100</td><td>南京市</td><td>11</td><td>city</td><td>{&#39;adcode&#39;: 320000}</td><td>0</td><td>MULTIPOLYGON (((19828216.260 3681802.361, 1982...</td><td>16907.9</td><td>2</td></tr><tr><th>1</th><td>320200</td><td>无锡市</td><td>7</td><td>city</td><td>{&#39;adcode&#39;: 320000}</td><td>1</td><td>MULTIPOLYGON (((19892555.472 3541293.638, 1989...</td><td>14850.8</td><td>1</td></tr><tr><th>2</th><td>320300</td><td>徐州市</td><td>10</td><td>city</td><td>{&#39;adcode&#39;: 320000}</td><td>2</td><td>MULTIPOLYGON (((19736418.457 3894748.096, 1973...</td><td>8457.8</td><td>0</td></tr><tr><th>3</th><td>320400</td><td>常州市</td><td>6</td><td>city</td><td>{&#39;adcode&#39;: 320000}</td><td>3</td><td>MULTIPOLYGON (((19927182.917 3638819.801, 1992...</td><td>9550.1</td><td>1</td></tr><tr><th>4</th><td>320500</td><td>苏州市</td><td>9</td><td>city</td><td>{&#39;adcode&#39;: 320000}</td><td>4</td><td>MULTIPOLYGON (((19929872.531 3547724.116, 1993...</td><td>23958.3</td><td>3</td></tr></tbody></table></div><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code><span class="token keyword">import</span> matplotlib<span class="token punctuation">.</span>colors <span class="token keyword">as</span> colors
fig<span class="token punctuation">,</span> ax <span class="token operator">=</span> plt<span class="token punctuation">.</span>subplots<span class="token punctuation">(</span>figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment">## 设置分层颜色条</span>
cmap <span class="token operator">=</span> plt<span class="token punctuation">.</span>cm<span class="token punctuation">.</span>get_cmap<span class="token punctuation">(</span><span class="token string">&#39;coolwarm&#39;</span><span class="token punctuation">,</span> <span class="token builtin">len</span><span class="token punctuation">(</span><span class="token builtin">set</span><span class="token punctuation">(</span>data<span class="token punctuation">[</span><span class="token string">&#39;GDP_class&#39;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment">## vmax和vmin设置是为了让等级值居中</span>
data<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>ax<span class="token operator">=</span>ax<span class="token punctuation">,</span>column<span class="token operator">=</span><span class="token string">&#39;GDP_class&#39;</span><span class="token punctuation">,</span> cmap<span class="token operator">=</span>cmap<span class="token punctuation">,</span> legend<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span>vmin<span class="token operator">=</span><span class="token operator">-</span><span class="token number">0.5</span><span class="token punctuation">,</span>vmax<span class="token operator">=</span><span class="token number">3.5</span><span class="token punctuation">)</span>
ax<span class="token punctuation">.</span>axis<span class="token punctuation">(</span><span class="token string">&#39;off&#39;</span><span class="token punctuation">)</span>
<span class="token comment">## 设置Colorbar的刻度</span>
cbar <span class="token operator">=</span> ax<span class="token punctuation">.</span>get_figure<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>colorbar<span class="token punctuation">(</span>ax<span class="token punctuation">.</span>collections<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>shrink<span class="token operator">=</span><span class="token number">0.5</span><span class="token punctuation">)</span>
cbar<span class="token punctuation">.</span>set_ticks<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
cbar<span class="token punctuation">.</span>set_label<span class="token punctuation">(</span><span class="token string">&#39;GDP数据分级&#39;</span><span class="token punctuation">)</span>
cbar<span class="token punctuation">.</span>set_ticklabels<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">&#39;等级0&#39;</span><span class="token punctuation">,</span><span class="token string">&#39;等级1&#39;</span><span class="token punctuation">,</span><span class="token string">&#39;等级2&#39;</span><span class="token punctuation">,</span><span class="token string">&#39;等级3&#39;</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token comment">## 隐藏刻度线</span>
ticks <span class="token operator">=</span> cbar<span class="token punctuation">.</span>ax<span class="token punctuation">.</span>get_yaxis<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>get_major_ticks<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">for</span> tick <span class="token keyword">in</span> ticks<span class="token punctuation">:</span>
    tick<span class="token punctuation">.</span>tick1line<span class="token punctuation">.</span>set_visible<span class="token punctuation">(</span><span class="token boolean">False</span><span class="token punctuation">)</span>
    tick<span class="token punctuation">.</span>tick2line<span class="token punctuation">.</span>set_visible<span class="token punctuation">(</span><span class="token boolean">False</span><span class="token punctuation">)</span>


<span class="token comment">## 设置</span>
fontdict <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">&#39;family&#39;</span><span class="token punctuation">:</span><span class="token string">&#39;FZSongYi-Z13S&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;size&#39;</span><span class="token punctuation">:</span><span class="token number">8</span><span class="token punctuation">,</span> <span class="token string">&#39;color&#39;</span><span class="token punctuation">:</span> <span class="token string">&quot;black&quot;</span><span class="token punctuation">,</span><span class="token string">&#39;weight&#39;</span><span class="token punctuation">:</span> <span class="token string">&#39;bold&#39;</span><span class="token punctuation">}</span>

<span class="token comment">## 设置标题</span>
ax<span class="token punctuation">.</span>set_title<span class="token punctuation">(</span><span class="token string">&#39;江苏省地级市2022年GDP数据可视化&#39;</span><span class="token punctuation">,</span> fontsize<span class="token operator">=</span><span class="token number">24</span><span class="token punctuation">)</span> 
<span class="token keyword">for</span> index <span class="token keyword">in</span> data<span class="token punctuation">.</span>index<span class="token punctuation">:</span>
    x <span class="token operator">=</span> data<span class="token punctuation">.</span>iloc<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">.</span>geometry<span class="token punctuation">.</span>centroid<span class="token punctuation">.</span>x
    y <span class="token operator">=</span> data<span class="token punctuation">.</span>iloc<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">.</span>geometry<span class="token punctuation">.</span>centroid<span class="token punctuation">.</span>y
    name <span class="token operator">=</span> data<span class="token punctuation">.</span>iloc<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">]</span>
    <span class="token keyword">if</span> name <span class="token keyword">in</span> <span class="token punctuation">[</span><span class="token string">&quot;苏州市&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;无锡市&quot;</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
        x <span class="token operator">=</span> x<span class="token operator">*</span><span class="token number">1.001</span>
    ax<span class="token punctuation">.</span>text<span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> name<span class="token punctuation">,</span> ha<span class="token operator">=</span><span class="token string">&quot;center&quot;</span><span class="token punctuation">,</span> va<span class="token operator">=</span><span class="token string">&quot;center&quot;</span><span class="token punctuation">,</span> fontdict<span class="token operator">=</span>fontdict<span class="token punctuation">)</span>
<span class="token comment">## 保存图片</span>
fig<span class="token punctuation">.</span>savefig<span class="token punctuation">(</span><span class="token string">&#39;res.png&#39;</span><span class="token punctuation">,</span> dpi<span class="token operator">=</span><span class="token number">300</span><span class="token punctuation">,</span> bbox_inches<span class="token operator">=</span><span class="token string">&#39;tight&#39;</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="https://gitlab.com/luohenyueji/article_picture_warehouse/-/raw/main/Python-Study-Notes/Mapping/[数据分析与可视化] Python绘制数据地图2-GeoPandas地图可视化/output_74_0.png" alt="png" tabindex="0" loading="lazy"><figcaption>png</figcaption></figure><p><strong>方法3</strong></p><p>分层设色不仅可以设置各区域的颜色，也可以设置各区域的填充图案</p><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code><span class="token comment">## 创建分类器</span>
classifier <span class="token operator">=</span> mapclassify<span class="token punctuation">.</span>MaximumBreaks<span class="token punctuation">(</span>data<span class="token punctuation">[</span><span class="token string">&#39;GDP&#39;</span><span class="token punctuation">]</span><span class="token punctuation">,</span> k<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">)</span>
classifier
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><pre><code>MaximumBreaks

      Interval         Count
----------------------------
[ 4005.00, 13115.20] |    10
(13115.20, 20433.10] |     2
(20433.10, 23958.30] |     1
</code></pre><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code><span class="token comment">## 赋值数据</span>
data<span class="token punctuation">[</span><span class="token string">&#39;GDP_class&#39;</span><span class="token punctuation">]</span> <span class="token operator">=</span> data<span class="token punctuation">[</span><span class="token string">&#39;GDP&#39;</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token builtin">apply</span><span class="token punctuation">(</span>classifier<span class="token punctuation">)</span>
data<span class="token punctuation">[</span><span class="token string">&#39;GDP_class&#39;</span><span class="token punctuation">]</span> <span class="token operator">=</span> data<span class="token punctuation">[</span><span class="token string">&#39;GDP_class&#39;</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token builtin">apply</span><span class="token punctuation">(</span><span class="token keyword">lambda</span> x <span class="token punctuation">:</span> <span class="token builtin">int</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span>
data<span class="token punctuation">.</span>head<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div><table border="1" class="dataframe"><thead><tr style="text-align:right;"><th></th><th>adcode</th><th>name</th><th>childrenNum</th><th>level</th><th>parent</th><th>subFeatureIndex</th><th>geometry</th><th>GDP</th><th>GDP_class</th></tr></thead><tbody><tr><th>0</th><td>320100</td><td>南京市</td><td>11</td><td>city</td><td>{&#39;adcode&#39;: 320000}</td><td>0</td><td>MULTIPOLYGON (((19828216.260 3681802.361, 1982...</td><td>16907.9</td><td>1</td></tr><tr><th>1</th><td>320200</td><td>无锡市</td><td>7</td><td>city</td><td>{&#39;adcode&#39;: 320000}</td><td>1</td><td>MULTIPOLYGON (((19892555.472 3541293.638, 1989...</td><td>14850.8</td><td>1</td></tr><tr><th>2</th><td>320300</td><td>徐州市</td><td>10</td><td>city</td><td>{&#39;adcode&#39;: 320000}</td><td>2</td><td>MULTIPOLYGON (((19736418.457 3894748.096, 1973...</td><td>8457.8</td><td>0</td></tr><tr><th>3</th><td>320400</td><td>常州市</td><td>6</td><td>city</td><td>{&#39;adcode&#39;: 320000}</td><td>3</td><td>MULTIPOLYGON (((19927182.917 3638819.801, 1992...</td><td>9550.1</td><td>0</td></tr><tr><th>4</th><td>320500</td><td>苏州市</td><td>9</td><td>city</td><td>{&#39;adcode&#39;: 320000}</td><td>4</td><td>MULTIPOLYGON (((19929872.531 3547724.116, 1993...</td><td>23958.3</td><td>2</td></tr></tbody></table></div><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code><span class="token keyword">import</span> matplotlib<span class="token punctuation">.</span>patches <span class="token keyword">as</span> mpatches

<span class="token comment">## 设置图案列表</span>
patterns <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">&quot;///&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span>  <span class="token string">&quot;*&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;\\\\\\\\&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;.&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;o&quot;</span><span class="token punctuation">,</span>  <span class="token string">&quot;O&quot;</span><span class="token punctuation">,</span><span class="token punctuation">]</span>
cmap <span class="token operator">=</span> plt<span class="token punctuation">.</span>cm<span class="token punctuation">.</span>get_cmap<span class="token punctuation">(</span><span class="token string">&#39;coolwarm&#39;</span><span class="token punctuation">,</span> <span class="token builtin">len</span><span class="token punctuation">(</span><span class="token builtin">set</span><span class="token punctuation">(</span>data<span class="token punctuation">[</span><span class="token string">&#39;GDP_class&#39;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
color_list <span class="token operator">=</span> cmap<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
fig<span class="token punctuation">,</span> ax <span class="token operator">=</span> plt<span class="token punctuation">.</span>subplots<span class="token punctuation">(</span>figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment">## 自定义图示</span>
legend_list <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>

<span class="token comment">## 按层次设置legend</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">set</span><span class="token punctuation">(</span>data<span class="token punctuation">[</span><span class="token string">&#39;GDP_class&#39;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    tmp <span class="token operator">=</span> data<span class="token punctuation">[</span>data<span class="token punctuation">[</span><span class="token string">&#39;GDP_class&#39;</span><span class="token punctuation">]</span><span class="token operator">==</span>i<span class="token punctuation">]</span>
    tmp<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>ax<span class="token operator">=</span>ax<span class="token punctuation">,</span>column<span class="token operator">=</span><span class="token string">&#39;GDP_class&#39;</span><span class="token punctuation">,</span> legend<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span>hatch<span class="token operator">=</span>patterns<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span>edgecolor<span class="token operator">=</span><span class="token string">&#39;black&#39;</span><span class="token punctuation">,</span>color<span class="token operator">=</span>color_list<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> linestyle<span class="token operator">=</span><span class="token string">&#39;-&#39;</span><span class="token punctuation">,</span>linewidth<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span>
    legend_list<span class="token punctuation">.</span>append<span class="token punctuation">(</span>
        mpatches<span class="token punctuation">.</span>Patch<span class="token punctuation">(</span>facecolor<span class="token operator">=</span>color_list<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> edgecolor<span class="token operator">=</span><span class="token string">&#39;black&#39;</span><span class="token punctuation">,</span>linestyle<span class="token operator">=</span><span class="token string">&#39;-&#39;</span><span class="token punctuation">,</span> linewidth<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span>hatch<span class="token operator">=</span>patterns<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> label<span class="token operator">=</span><span class="token string">&#39;等级{}&#39;</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">)</span>
ax<span class="token punctuation">.</span>axis<span class="token punctuation">(</span><span class="token string">&#39;off&#39;</span><span class="token punctuation">)</span>
<span class="token comment">## 设置标题</span>
ax<span class="token punctuation">.</span>set_title<span class="token punctuation">(</span><span class="token string">&#39;江苏省地级市2022年GDP数据可视化&#39;</span><span class="token punctuation">,</span> fontsize<span class="token operator">=</span><span class="token number">24</span><span class="token punctuation">)</span> 

<span class="token comment">## 自定义图示</span>
ax<span class="token punctuation">.</span>legend<span class="token punctuation">(</span>handles <span class="token operator">=</span> legend_list<span class="token punctuation">,</span> loc<span class="token operator">=</span><span class="token string">&#39;best&#39;</span><span class="token punctuation">,</span> fontsize<span class="token operator">=</span><span class="token number">12</span><span class="token punctuation">,</span> title<span class="token operator">=</span><span class="token string">&#39;GDP数据分级&#39;</span><span class="token punctuation">,</span> shadow<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>

<span class="token comment">## 保存图片</span>
fig<span class="token punctuation">.</span>savefig<span class="token punctuation">(</span><span class="token string">&#39;res.png&#39;</span><span class="token punctuation">,</span> dpi<span class="token operator">=</span><span class="token number">300</span><span class="token punctuation">,</span> bbox_inches<span class="token operator">=</span><span class="token string">&#39;tight&#39;</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="https://gitlab.com/luohenyueji/article_picture_warehouse/-/raw/main/Python-Study-Notes/Mapping/[数据分析与可视化] Python绘制数据地图2-GeoPandas地图可视化/output_78_0.png" alt="png" tabindex="0" loading="lazy"><figcaption>png</figcaption></figure><h2 id="_3-参考" tabindex="-1"><a class="header-anchor" href="#_3-参考" aria-hidden="true">#</a> 3 参考</h2>`,38),N={href:"https://github.com/geopandas/geopandas",target:"_blank",rel:"noopener noreferrer"},S={href:"https://geopandas.org/en/stable/docs.html",target:"_blank",rel:"noopener noreferrer"},z={href:"https://blog.csdn.net/LuohenYJ/article/details/129596398",target:"_blank",rel:"noopener noreferrer"},O={href:"https://pandas.pydata.org/pandas-docs/stable/user_guide/visualization.html",target:"_blank",rel:"noopener noreferrer"},D={href:"https://www.cnblogs.com/feffery/p/12361421.html",target:"_blank",rel:"noopener noreferrer"},M={href:"https://cloud.tencent.com/developer/article/1790603",target:"_blank",rel:"noopener noreferrer"},T={href:"https://github.com/pysal/mapclassify",target:"_blank",rel:"noopener noreferrer"},L={href:"https://www.cnblogs.com/feffery/p/12381322.html",target:"_blank",rel:"noopener noreferrer"};function I(E,A){const a=e("ExternalLinkIcon");return c(),l("div",null,[u,n("p",null,[s("本文主要介绍GeoPandas结合matplotlib实现地图的基础可视化。GeoPandas是一个Python开源项目，旨在提供丰富而简单的地理空间数据处理接口。GeoPandas扩展了Pandas的数据类型，并使用matplotlib进行绘图。GeoPandas官方仓库地址为："),n("a",r,[s("GeoPandas"),t(a)]),s("。GeoPandas的官方文档地址为："),n("a",d,[s("GeoPandas-doc"),t(a)]),s("。关于GeoPandas的使用见"),n("a",k,[s("[数据分析与可视化] Python绘制数据地图1-GeoPandas入门指北"),t(a)]),s("。")]),n("p",null,[s("本文所有代码见："),n("a",m,[s("Python-Study-Notes"),t(a)])]),v,n("p",null,[s("GeoPandas的绘图函数中通过cmap参数设置颜色图，具体cmap参数的设置可以见"),n("a",g,[s("matplotlib颜色图选择教程"),t(a)]),s("。")]),b,n("p",null,[s("GeoPandas的Plot函数还允许设置kind参数绘制不同类型的图形，kind默认为geo（地图），其他可选参数与pandas默认提供的绘图函数一致。pandas默认提供的绘图函数见："),n("a",h,[s("Chart visualization"),t(a)]),s("。")]),y,n("ul",null,[n("li",null,[n("a",x,[s("基于geopandas的空间数据分析之基础可视化"),t(a)])]),n("li",null,[n("a",f,[s("geopandas 中国地图绘制"),t(a)])])]),_,n("p",null,[s("mapclassify官方仓库见："),n("a",w,[s("mapclassify"),t(a)]),s("。mapclassify提供了多种分组方法，可以帮助我们更好地理解数据的分布情况，mapclassify提供的方法包括：")]),P,n("p",null,[s("关于以上常用方法的具体介绍可以看看"),n("a",q,[s("基于geopandas的空间数据分析——深入浅出分层设色"),t(a)]),s("。mapclassify对数据进行分类简单使用方法如下：")]),G,n("ul",null,[n("li",null,[n("a",N,[s("GeoPandas"),t(a)])]),n("li",null,[n("a",S,[s("GeoPandas-doc"),t(a)])]),n("li",null,[n("a",z,[s("[数据分析与可视化] Python绘制数据地图1-GeoPandas入门指北"),t(a)])]),n("li",null,[n("a",O,[s("Chart visualization"),t(a)])]),n("li",null,[n("a",D,[s("基于geopandas的空间数据分析之基础可视化"),t(a)])]),n("li",null,[n("a",M,[s("geopandas 中国地图绘制"),t(a)])]),n("li",null,[n("a",T,[s("mapclassify"),t(a)])]),n("li",null,[n("a",L,[s("基于geopandas的空间数据分析——深入浅出分层设色"),t(a)])])])])}const j=o(i,[["render",I],["__file","2023-04-09-_数据分析与可视化_ Python绘制数据地图2-GeoPandas地图可视化.html.vue"]]);export{j as default};
